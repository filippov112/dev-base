#theory #theory-ml
 
---
#### СРАВНЕНИЕ КОНТЕНТА КОТИКОВ И СТИЛИЗОВАННЫХ КОТИКОВ

Средний квадрат разницы по контенту можно вычислить с использованием встроенных методов пакета Tensorflow:

```python
def get_content_loss(base_content, target):
  return tf.reduce_mean(tf.square(base_content - target))
```
`square()` - возвращает тензор квадратов разностей между признаками.
`reduce_mean()` - вычисляет среднее арифметическое от полученного тензора квадратов.

---
#### СРАВНЕНИЕ СТИЛЕЙ КАРТИНЫ И СТИЛИЗОВАННЫХ КОТИКОВ

Для вычисления потерь по стилю, вначале определим функцию вычисления матрицы Грама для переданного ей тензора:

```python
def gram_matrix(input_tensor):
  channels = int(input_tensor.shape[-1])  # сохраняем число карт признаков
  a = tf.reshape(input_tensor, [-1, channels])  # разворачиваем тензор в матрицу (карта признаков X число карт)
  n = tf.shape(a)[0]  # сохраняем размер столбца для усреднения квадратов
  gram = tf.matmul(a, a, transpose_a=True)  # перемножаем матрицу на себя же транспонированную
  return gram / tf.cast(n, tf.float32)  # делим на размер стороны матрицы (Mg = 1/n * G * Gt)
```

Реализуем функцию, которая будет вычислять сумму квадратов рассогласований между тензорами стилизованных котиков и картины:

```python
def get_style_loss(base_style, gram_target):
  gram_style = gram_matrix(base_style)  # base_style - стилизованные котики (котиков мы передаем после каждого редактирования и граммируем перед сравнением)
  return tf.reduce_mean(tf.square(gram_style - gram_target))
```
`gram_target` - картина (уже граммированные).
`reduce_mean()` - считает разницу между тензорами также как с контентом.
