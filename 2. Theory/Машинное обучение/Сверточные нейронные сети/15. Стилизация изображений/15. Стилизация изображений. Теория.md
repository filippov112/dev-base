
# Оценка качества формирования изображения с использованием сети VGG19

## Критерии качества

Леон Гатис разделил общий критерий качества на две независимые оценки:

- **Степень соответствия**: оценивает, насколько преобразованное изображение соответствует исходному.
- **Степень стилизации**: оценивает, насколько преобразованное изображение имеет абстракцию и сходство стиля.

Эти оценки суммируются с определенными весами для формирования общего показателя качества.

## Оценка степени соответствия

1. Пропускаем исходное изображение через сеть VGG19 и получаем набор признаков на последнем слое.
2. Пропускаем модифицированное изображение через ту же сеть и получаем признаки.
3. Вычисляем показатель качества (L) для контента:

   ```
   L = frac{sum_{c} sum_{h} sum_{w} (P_{chw} - T_{chw})^2}{4 times N_h times N_w times N_c}
   ```

   Где:
   - ( P_{chw} ) - значение признака в точке формируемого изображения,
   - ( T_{chw} ) - значение признака в точке исходного изображения,
   - ( N_h ), ( N_w ), ( N_c ) - высота, ширина и количество каналов соответственно.

## Оценка степени стилизации

1. Пропускаем стилевое изображение через сеть VGG19 и вычисляем матрицу Грама для признаков.
2. Для формируемого изображения также вычисляем матрицу Грама.
3. Вычисляем показатель сходства стиля (J):

   ```
   J = frac{sum_{h} sum_{w} (G_{p_{hw}} - G_{s_{hw}})^2}{N_c^2 times (N_h times N_w)^2}
   ```

   Где:
   - ( G_{p} ) - матрица Грама для формируемого изображения,
   - ( G_{s} ) - матрица Грама для стилевого изображения.

4. Повторяем вычисления для нижних слоев сети VGG19 для формирования суммарного показателя стилизации ( J_s ).

   ```
   J_s = J1 + J2 + J3 + J4 + J5
   ```

## Общий показатель качества

Общий показатель качества формируемого изображения вычисляется как взвешенная сумма показателей степени соответствия и стилизации:

```
J = L cdot a + J_s cdot b
```

Где ( a ) и ( b ) - веса, определяющие важность учета контента и стиля соответственно.

## Оптимизация изображения

Для минимизации показателя ( J ) используется градиентный спуск:

```
text{pixel}(N) = text{pixel}(N-1) - lambda cdot text{grad}(J)
```

Где ( lambda ) - коэффициент скорости обучения, а ( text{grad}(J) ) - градиент показателя качества.
