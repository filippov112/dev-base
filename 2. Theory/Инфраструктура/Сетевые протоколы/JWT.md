
# JWT

### Что такое JWT?

JWT (JSON Web Token) — это способ безопасной передачи информации между сторонами в формате JSON. 
- обычно используется для аутентификации и авторизации пользователей.
- позволяет передавать данные безопасно и без сохранения состояния на сервере.
- Состоит из 3 частей, разделённых точками:
	```
	header.payload.signature
	```
	- **Header** (заголовок) — указывает тип токена и алгоритм шифрования.
	- **Payload** (полезная нагрузка) — содержит данные (например, ID пользователя, роль).
	- **Signature** (подпись) — защищает токен от подделки.

#### Роли
В процессе JWT-аутентификации участвуют три основные роли:

1. **Issuer (Издатель)** — сервер или сервис, который создает и подписывает JWT. Обычно это аутентификационный сервер, например, _Auth0_, _Keycloak_ или собственная реализация. Он проверяет учетные данные пользователя и выдает токен.
2. **Client (Клиент)** — приложение или пользовательский агент (например, браузер, мобильное приложение, Postman), который получает JWT после успешной аутентификации и использует его для доступа к ресурсам. Токен отправляется в заголовке `Authorization: Bearer <token>`.
3. **Resource Server (Сервер ресурсов)** — API или веб-приложение, которое получает запрос с JWT, проверяет его валидность (подпись, срок действия, claims) и на основе информации в токене решает, предоставлять доступ или нет.

Дополнительно может участвовать **Identity Provider (IdP)**, если аутентификация делегирована внешнему провайдеру, например, через OAuth 2.0 или OpenID Connect. В этом случае IdP выполняет роль Issuer.

#### Принцип действия
1. **Клиент авторизуется** (например, отправляя логин и пароль).
2. **Сервер проверяет данные** и создаёт JWT.
3. **JWT отправляется клиенту** и хранится (например, в локальном хранилище или куки).
4. **При каждом запросе** клиент отправляет JWT в заголовке запроса.
5. **Сервер проверяет токен**, если он валиден — выполняет запрос. Сервер проверяет валидность JWT (JSON Web Token) следующим образом:
	1. **Разбирает токен** — JWT состоит из трёх частей (заголовок, полезная нагрузка, подпись), разделённых точками.
	2. **Проверяет подпись** — используется алгоритм из заголовка (например, HMAC, RSA, ECDSA). Если токен подписан симметричным ключом (HMAC), сервер использует секретный ключ, если асимметричным (RSA, ECDSA) — ==*публичный ключ==.[RSA для проверки подписи](2.%20Theory/Программирование/8.%20Алгоритмы/Шифрование/RSA%20для%20проверки%20подписи.md)
	3. **Проверяет срок действия** — если в payload есть поле `exp`, сервер убеждается, что время не истекло.
	4. **Проверяет issuer и audience** — если используются поля `iss` (кто выдал токен) и `aud` (для кого предназначен), сервер удостоверяется, что они совпадают с ожидаемыми значениями.
	5. **Проверяет другие claims** — при необходимости анализируются другие поля, такие как `nbf` (not before) или `sub` (subject).


#### **Преимущества:**
1. **Статусная (stateless) аутентификация** — серверу не нужно хранить сессии, так как вся информация о пользователе уже в токене. Это снижает нагрузку на базу данных и упрощает масштабирование.
2. **Гибкость** — токен можно передавать между разными сервисами и доменами, что удобно в микросервисной архитектуре.
3. **Производительность** — проверка JWT выполняется локально без запросов к базе, что ускоряет обработку запросов.
4. **Безопасность** — использование цифровой подписи предотвращает подделку токенов. Можно применять асимметричное шифрование для разделения ответственности между issuer и verifier.
    
#### **Другие способы аутентификации:**
- **Basic Auth** — передача `username:password` в заголовке `Authorization`. Устаревший метод, так как требует шифрования соединения (HTTPS) и уязвим к утечкам.
- **Сессионная аутентификация** — сервер создает сессию и хранит ID в cookies, что требует управления хранилищем сессий.
- **OAuth 2.0** — протокол, использующий access-токены, часто в виде JWT. Подходит для аутентификации через сторонние сервисы (Google, Facebook и т. д.).
- **API Key** — клиент передает ключ в заголовке или URL-параметре. Менее безопасный вариант, так как ключ можно легко скомпрометировать.
- **SAML (Security Assertion Markup Language)** — XML-формат для передачи данных об аутентификации и авторизации. Используется в корпоративных решениях, но сложнее в интеграции.

---

### Inner links:
[2. JWT + ASP.NET](1.%20Languages/C-sharp/_%20ASP.NET/ASP.NET%20Core/12.%20Аутентификация%20и%20авторизация/2.%20JWT%20+%20ASP.NET.md)
### Outer links:

