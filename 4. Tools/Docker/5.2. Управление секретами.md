 

# 5.2. Управление секретами в Docker

**1. Избегайте хранения в Dockerfile**
Секреты, добавленные таким образом, могут быть легко извлечены из истории сборки или слоев образа. 

**2. Docker Secrets**
Встроенный механизм безопасного хранения и передачи конфиденциальных данных в сервисы, работающие в режиме *Docker Swarm*. 
Секреты хранятся в зашифрованном виде и передаются только тем контейнерам, которым они необходимы.
	1. Создайте секрет.
	2. Разверните сервис с подключенным секретом. В контейнере секрет будет доступен по пути `/run/secrets/db_password`. 
```bash
echo "your_password" | docker secret create db_password - 
docker service create --name my_service --secret db_password my_image
```

**3. Docker Compose**
В Docker Compose, вы можете определить секреты в `docker-compose.yml`.
```yaml
version: '3.7'
services:
  app:
    image: my_image
    secrets:
      - db_password

secrets:
  db_password:
    file: ./db_password.txt
```

**4. Избегайте переменных окружения**
Переменные окружения могут быть легко прочитаны изнутри контейнера. 

**5. Сторонние менеджеры секретов**
Для более сложных сценариев и дополнительного уровня безопасности. 
*HashiCorp Vault* или *Keeper Secrets Manager*. 
Расширенные возможности для хранения, управления и аудита доступа к конфиденциальным данным.

**6. Ограничивайте доступ и устанавливайте правильные разрешения**
Настройте контроль доступа на основе ролей (*RBAC*) и устанавливайте минимально необходимые привилегии для каждого компонента системы.

### Outer links:
- [Обзор способов защиты контейнеров Docker: от простого к ...](https://habr.com/ru/companies/selectel/articles/854850/)
- [Безопасность контейнеров: лучшие практики для Docker и ...](https://www.securitylab.ru/blog/personal/paragraph/353741.php)
- [Исчерпывающее пособие по безопасной сборке Docker-образов](https://selectel.ru/blog/docker-security-2/)
- [Doker: безопасные контейнеры виртуальной среды - GeekBrains](https://gb.ru/blog/doker/)
- [Как повысить безопасность Docker-контейнеров: лучшие практики](https://timeweb.cloud/tutorials/docker/kak-povysit-bezopasnost-docker)
- [Как легко защитить секреты Docker с помощью Keeper Secrets ...](https://www.keepersecurity.com/blog/ru/2022/02/16/easily-secure-docker-secrets-with-keeper-secrets-manager/)
