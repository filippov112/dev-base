#devops #Docker

# 5.1. Оптимизация образов в Docker

#### **1. Выбор легковесных базовых образов**
Таких как `alpine`. Однако они могут требовать дополнительной настройки и установки пакетов. 

#### **2. Многоэтапная сборка (multi-stage builds)**
Помогает исключить из финального образа ненужные зависимости и инструменты сборки. 
Полезно для компилируемых языков, где требуется только исполняемый файл. 
```dockerfile
# Этап сборки
FROM golang:alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# Этап выполнения
FROM alpine
WORKDIR /app
COPY --from=builder /app/myapp .
CMD ["./myapp"]
```

#### **3. Минимизация количества слоев**
Каждая инструкция в Dockerfile создает новый слой в образе. 
*Объединение команд* позволяет уменьшить количество слоев и, соответственно, размер образа. 
```dockerfile
RUN apt-get update && apt-get install -y \
    package1 \
    package2 \
    && rm -rf /var/lib/apt/lists/*
```

#### **4. Исключение ненужных файлов**
Используйте файл `.dockerignore` для исключения из образа файлов и директорий, которые не нужны в контейнере (например, документация, файлы тестов, локальные конфигурации). 
```
*.md
tests/
.git
```

#### **5. Очистка кэша пакетных менеджеров**
После установки пакетов рекомендуется удалять временные файлы и кэш. 
```dockerfile
RUN apt-get update && apt-get install -y package \
    && rm -rf /var/lib/apt/lists/*
```

#### **6. Использование сжатия образов**
После сборки образа можно использовать инструменты для его сжатия, такие как `docker-slim`.

### Outer links:
- [Оптимизация Dockerfile для уменьшения размера и быстрой ...](https://habr.com/ru/companies/first/articles/702168/?utm_source=chatgpt.com)
- [Оптимизация Docker-образов с помощью многоэтапной сборки](https://proglib.io/p/stroynye-konteynery-kak-umenshit-docker-obraz-s-pomoshchyu-mnogoetapnoy-sborki-2024-11-13?utm_source=chatgpt.com)
- [Методики уменьшения размеров образов Docker - Habr](https://habr.com/ru/companies/ruvds/articles/485650/?utm_source=chatgpt.com)
- [5 способов оптимизации сборки Docker-образов - mhost.by](https://mhost.by/knowledgebase/67/5-sposobov-optimizatcii-sborki-docker-obrazov.html?utm_source=chatgpt.com)