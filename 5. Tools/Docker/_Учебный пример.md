#tool #tool-docker

---
- **Загрузка образа** - `docker pull <name>`
- **Список загруженных образов** - `docker image`
- **Запуск** контейнера - `docker run <name>`
> - https://docs.docker.com/engine/reference/commandline/run/
> - `-i` - интерактивный запуск
> - `-t` - псевдо-консоль (`-it` - для контейнеров с образами полной OS)
> - `-rm` - удалить контейнер после выхода из него
- Список работающих контейнеров - `docker ps`
> - `-a` - всех контейнеров
- **Удаление** контейнера по псевдониму - `docker rm <name>`
- **Наименование** контейнера - при запуске `docker run --name cool <name>`, после запуска `docker rename cool <name>`
- **Перезапуск** - остановка `docker stor <name>`, запуск `docker start <name>`
- **Проброс команд внутрь** - `docker exec [-it] <cont_name> <command>`
- **Смонтировать папку** из основной машины в контейнере: `docker run -v <dir>:<container_dir> <container>`

# Пример

### Установка
[https://docker.com](https://docker.com/) // personal — наш выбор, бесплатно; pro, team, business — крутым парням и компаниям, платно
на linux ставится *из их собственного репозитория*, с отдельного *.deb пакета* или готовым *скриптом*

Инструкция - [docs.docker.com/engine/install/Debian](https://docs.docker.com/engine/install/debian/)

1. **Самый простой (но не рекомендуется) — загрузить и запустить скрипт:**
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sh ./get-docker.sh
```

2. **С репозитория**
- зависимости: `apt-get install ca-certificates curl gnupg lsb-release`
- ключ: `curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg`
- добавить в sources.list репозиторий:
```bash
echo "deb \[arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] \https://download.docker.com/linux/debian $(lsb_release -cs) stable"
sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

### Пользователи
Создайте группу docker и добавьте вашего пользователя, чтобы работать без sudo:
```bash
groupadd docker
sudo usermod -aG docker <username>
```

### Автозагрузка
Добавьте сервисы *docker.service* и *containerd.service* в фоновый автозапуск (systemctl enable)
Существует два основных способа:

##### 1. Использование systemctl:
- Включите автозапуск сервисов:
```Bash
sudo systemctl enable docker.service
sudo systemctl enable containerd.service
```
- Запустите сервисы:
```Bash
sudo systemctl start docker.service
sudo systemctl start containerd.service
```
- Проверьте статус сервисов:
```bash
sudo systemctl status docker.service
sudo systemctl status containerd.service
```

##### 2. Использование файла systemd:
- Создайте файлы systemd для каждого сервиса:
```Bash
sudo nano /etc/systemd/system/docker.service
sudo nano /etc/systemd/system/containerd.service
```

- Добавьте следующий контент в файлы, заменив `<user>` своим именем пользователя:
```bash
[Unit]
Description=Docker Service
After=network-online.target
Requires=containerd.service

[Service]
User=<user>
Group=docker
ExecStart=/usr/bin/dockerd
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
[Unit]
Description=containerd Service
After=network-online.target

[Service]
Type=simple
User=root
ExecStart=/usr/bin/containerd
Restart=always

[Install]
WantedBy=multi-user.target
```
- Перезагрузите файлы systemd:
```Bash
sudo systemctl daemon-reload
```
- Включите и запустите сервисы:
```Bash
sudo systemctl enable docker.service
sudo systemctl enable containerd.service
sudo systemctl start docker.service
sudo systemctl start containerd.service
```
- Проверьте статус сервисов, чтобы убедиться, что они запущены и включены в автозапуск:
```Bash
systemctl status docker.service
systemctl status containerd.service
```

