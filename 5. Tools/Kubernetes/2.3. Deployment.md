#tool #tool-k8s

---
**Deployment** - управляет развертыванием ReplicaSet и обеспечивает декларативное обновление Pod, позволяя легко контролировать версии приложений и откатываться при необходимости.

*Манифест Deployment* описывается в YAML-файле
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app-container
        image: my-app-image:v1
        ports:
        - containerPort: 8080
```

---
#### **Управление Deployment-ом:**

- Применение изменений:
	```bash
	kubectl apply -f deployment.yaml
	```
- Откат к предыдущим версиям:
	```bash
	kubectl rollout undo deployment/my-app-deployment
	```
- Откат к конкретной версии:
	```bash
	kubectl rollout undo deployment/my-app-deployment --to-revision=2
	```
- История развертываний:
	```bash
	kubectl rollout history deployment/my-app-deployment
	```

---
#### **Стратегии развертывания:**

1. ***Rolling Update:*** (Постепенное обновление, по умолчанию) - новые Pod'ы создаются и заменяют старые по одному. 
	Можно настроить пар-ы:
	- минимальное количество доступных Pod'ов
	- `maxSurge` - максимальное превышение желаемого количество Pod'ов.
	- `maxUnavailable` - максимальное количество обновляемых Pod'ов
	```yaml
	spec:
	  strategy:
	    type: RollingUpdate
	    rollingUpdate:
	      maxSurge: 1
	      maxUnavailable: 0
	```

2. ***Recreate:*** (Повторное создание) - все старые Pod'ы удаляются перед созданием новых. 
	```yaml
	spec:
	  strategy:
	    type: Recreate
	```

### Outer links:
- [Официальная документация Kubernetes: Deployment](https://kubernetes.io/ru/docs/concepts/workloads/controllers/deployment/)
- [Статья на Хабре: "K8S для начинающих. Первая часть"](https://habr.com/ru/articles/589415/)