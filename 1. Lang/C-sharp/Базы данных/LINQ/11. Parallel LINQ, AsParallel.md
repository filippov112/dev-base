#lang #lang-c_sharp 

---
**PLINQ** (.NET 4.0) используется для *параллельной* обработки запросов (в отличие от последовательного LINQ).
1. PLINQ эффективно использует ресурсы многоядерных процессоров, *разделяя источник данных на сегменты* для обработки в отдельных потоках, что ускоряет выполнение на больших коллекциях и сложных операциях. 
2. PLINQ *автоматически* выбирает режим обработки — последовательный или параллельный — в зависимости от затрат на ресурсы и предполагаемого ускорения.
3. При параллельной обработке важно учитывать затраты на *синхронизацию для доступа к общему состоянию*, поскольку это может снизить производительность.

#### Класс `ParallelEnumerable`
- **Метод `AsParallel()`** - позволяет распараллелить запрос к источнику данных, что превращает обычный запрос LINQ в параллельный, если это оправдано.
- **Метод `ForAll()`** - позволяет избежать дополнительных издержек при выводе данных параллельных операций, так как оно выводит данные непосредственно в том потоке, где они обрабатываются.

---

### Примеры:

1. **Пример с `AsParallel` для нахождения квадратов чисел** — показывает, как распараллеливание ускоряет выполнение запроса:
    ```csharp
    int[] numbers = new int[] { 1, 2, 3, 4, 5, 6, 7, 8 };
    var squares = from n in numbers.AsParallel()
                     select Square(n);

    foreach (var n in squares)
        Console.WriteLine(n);

    int Square(int n) => n * n;
    ```
   *Результат*: Порядок вывода может быть произвольным, например:
   ```
   49
   1
   9
   25
   64
   4
   16
   36
   ```
   *Ссылка на положения*: [1, 2, 5]

2. **Аналогичная операция через методы расширения**:
    ```csharp
    var squares = numbers.AsParallel().Select(x => Square(x));
    ```
   *Ссылка на положения*: [1, 5]

3. **Пример с `ForAll` для оптимизированного вывода** — минимизирует издержки на перебор данных из параллельных потоков:
    ```csharp
    int[] numbers = new int[] { 1, 2, 3, 4, 5, 6, 7, 8 };

    // С использованием оператора LINQ
    (from n in numbers.AsParallel() select Square(n)).ForAll(Console.WriteLine);

    // С использованием методов расширения LINQ
    numbers.AsParallel().Select(n => Square(n)).ForAll(Console.WriteLine);

    int Square(int n) => n * n;
    ```
   *Ссылка на положения*: [4, 6]

### Inner links:
[_ LINQ](1.%20Lang/C-sharp/Базы%20данных/LINQ/_%20LINQ.md)

### Outer links:
https://metanit.com/sharp/tutorial/17.1.php