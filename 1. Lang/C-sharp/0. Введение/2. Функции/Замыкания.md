#lang #lang-c_sharp

---
**Замыкание (closure)** - ***объект функции*** *(т.е. он делает снимок состояния своего окружения в момент инициализации)*, который запоминает свое лексическое окружение даже в том случае, когда она выполняется вне своей области видимости.

Включает 3 компонента:
- *внешняя функция*, которая определяет некоторую область видимости и в которой определены некоторые переменные и параметры - лексическое окружение
- переменные и параметры (*лексическое окружение*), которые определены во внешней функции
- *вложенная функция*, которая использует переменные и параметры внешней функции

2 способа реализации:

### 1. Через локальные функции

```csharp
var fn = Outer();   // fn = Inner, так как метод Outer возвращает функцию Inner
// вызываем внутреннюю функцию Inner
fn();   // 6
fn();   // 7
fn();   // 8
 
Action Outer()  // метод или внешняя функция
{
    int x = 5;  // лексическое окружение - локальная переменная
    void Inner()    // локальная функция
    {
        x++;        // операции с лексическим окружением
        Console.WriteLine(x);
    }
    return Inner;   // возвращаем локальную функцию
}
```

### 2. Через лямбда-выражения

```csharp
var outerFn = () =>
{
    int x = 10;
    var innerFn = () => Console.WriteLine(++x);
    return innerFn;
};
 
var fn = outerFn();   // fn = innerFn, так как outerFn возвращает innerFn
// вызываем innerFn
fn();   // 11
fn();   // 12
fn();   // 13
```

---
**Пример с параметрами:**
```csharp
var fn = Multiply(5);  
 
Console.WriteLine(fn(5));   // 25
Console.WriteLine(fn(6));   // 30
Console.WriteLine(fn(7));   // 35
 
Operation Multiply(int n)
{
    int Inner(int m)
    {
        return n * m;
    }
    return Inner;
}
delegate int Operation(int n);
```

**Краткий вариант:**
```csharp
var multiply = (int n) => (int m) => n * m; 
 
var fn = multiply(5);  
 
Console.WriteLine(fn(5));   // 25
Console.WriteLine(fn(6));   // 30
Console.WriteLine(fn(7));   // 35
```

### Inner links:
[1. Функции](1.%20Lang/C-sharp/0.%20Введение/2.%20Функции/1.%20Функции.md)
