#lang #lang-c_sharp

---
Способы управления временем жизни сервисов:  

| Метод регистрации  | Описание | Когда создаётся? | Где используется? |  
|--------------------|----------|------------------|-------------------|  
| **`AddTransient`** | Новый объект при каждом запросе | При каждом вызове `GetService` | Легковесные, без состояния (например, `RandomGenerator`) |  
| **`AddScoped`**    | Один объект на область видимости (`scope`) | При создании `scope` | Веб-запросы, транзакции БД |  
| **`AddSingleton`** | Один объект на всё приложение | При первом запросе | Общие ресурсы (конфигурация, кэш) |  

- Не используйте `Scoped` сервисы в `Singleton` — это приведёт к утечкам памяти!  
- Для потокобезопасности `Singleton` сервисы должны быть либо неизменяемыми, либо использовать синхронизацию.  

---
- **Transient (кратковременные)**  

	```csharp
	services.AddTransient<ICounter, RandomCounter>();
	```  

- **Singleton (одиночные)**  

	```csharp
	services.AddSingleton<ICounter, RandomCounter>();
	```  

- **Scoped (областные)**  

	```csharp
	services.AddScoped<ICounter, RandomCounter>();
	
	using (var scope = serviceProvider.CreateScope())
	{
	    var counter1 = scope.ServiceProvider.GetService<ICounter>();
	    var counter2 = scope.ServiceProvider.GetService<ICounter>(); // тот же
	}
	```  

---
### Outer links:
- https://metanit.com/sharp/dotnet/1.3.php