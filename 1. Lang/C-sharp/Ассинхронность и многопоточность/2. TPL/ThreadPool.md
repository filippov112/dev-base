#lang #lang-c_sharp 

---
**Пул потоков** (Thread Pool) — механизм переиспользования потоков.
- **Выгода**: Позволяет повторно использовать потоки вместо того, чтобы создавать новые для каждой задачи, снижая затраты на создание/удаление потоков.
- **Реализация**: через класс **`ThreadPool`** в пространстве имен `System.Threading`. 
- **Динамическое управление потоками**: Пул потоков **не создает бесконечно много потоков**. Он ограничен количеством потоков, которое оптимально для текущей нагрузки. Количество потоков зависит от конфигурации пула и от операционной системы.    
- **Обработка задач**: Пул потоков **не блокирует основной поток** при ожидании выполнения задачи. Задачи, добавленные в пул, будут выполнены в порядке очередности и с использованием доступных потоков.

**Применение**: 
- Краткосрочные операции: ввод/вывод, обработка сообщений и др.

**Противопоказано**:
- Для долговременных задач.
- Когда требуется полный контроль над потоком.

#### Принцип работы
- Пул потоков поддерживает **определенное количество потоков**, которые могут выполнять задачи параллельно.
- Когда задача добавляется в пул, если в пуле есть свободный поток, он немедленно выполняет эту задачу.
- Если потоков недостаточно для выполнения всех задач, пул может создать новые потоки (в пределах **лимита**) или ожидать, пока один из потоков завершит свою задачу и освободит ресурсы.

---
#### <font color="#ffff00">Работа с пулом</font>:

- **`ThreadPool.QueueUserWorkItem`** - позволяет ставить задачу в очередь на выполнение.

В настройке пула потоков в C# используются **два типа потоков**:
1. **Рабочие потоки (Worker Threads)** — предназначены для выполнения вычислительных задач.
2. **Потоки ввода-вывода (I/O Threads)** — предназначены для асинхронных операций ввода-вывода, таких как работа с файлами, сетью, базами данных.   

- **`ThreadPool.SetMinThreads`** - установить минимальное число потоков 
- **`ThreadPool.SetMaxThreads`** - установить максимальное число потоков

- **`ThreadPool.GetAvailableThreads`** — для получения числа доступных потоков.
- **`ThreadPool.GetMaxThreads`** — для получения максимального числа потоков.
- **`ThreadPool.GetMinThreads`** — для получения минимального числа потоков.


```csharp
using System.Threading;

// Добавляем задачу в пул потоков
ThreadPool.QueueUserWorkItem(WorkerMethod);

// Метод, который будет выполняться в пуле потоков
static void WorkerMethod(object state)
{
	Console.WriteLine("Задача в пуле потоков начала выполнение...");
	Thread.Sleep(2000);  // Симуляция долгой операции
	Console.WriteLine("Задача в пуле потоков завершена.");
}

```

```csharp
using System.Threading;

// Настройка минимального и максимального количества потоков в пуле
ThreadPool.SetMinThreads(4, 4);  // Минимум 4 потока
ThreadPool.SetMaxThreads(8, 8);  // Максимум 8 потоков

// Запускаем несколько задач
for (int i = 0; i < 5; i++)
{
	ThreadPool.QueueUserWorkItem(WorkerMethod, i);
}

// Метод для выполнения задачи
static void WorkerMethod(object state)
{
	int taskId = (int)state;
	//Console.WriteLine($"Задача {taskId} начала выполнение.");
	//Thread.Sleep(1000);  // Симуляция долгой операции
	//Console.WriteLine($"Задача {taskId} завершена.");
}
```

