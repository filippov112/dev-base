#lang #lang-python 

---
Спрайт — это любой подвижный объект.  
Модуль для работы со спрайтами: `pygame.sprite`
Спрайты (объекты) создаются в виде классов-наследников стандартного класса `pygame.sprite.Sprite`. Для хранения классов спрайтов лучше всего выделить отдельный файл.

```python
class Ball(pygame.sprite.Sprite):
    def __init__(self, x, speed, filename):
        pygame.sprite.Sprite.__init__(self)
        self.image = pygame.image.load(filename).convert_alpha()
        self.rect = self.image.get_rect(center=(x, 0))
        self.speed = speed
```
Конструктор содержит обязательные свойства изображения и Rect-а нашего объекта — `image`, `rect`, а также другие свойства, которые мы хотим придать объекту.
Для определения физики поведения спрайта переопределим в нашем классе базовый метод `update`:

```python
def update(self, *args):
    if self.rect.y < args[0] - 20:
        self.rect.y += self.speed
    else:
        self.rect.y = 0
```

```python
b1 = Ball(W//2, speed, 'images/ball_bear.png')
```
При инициализации объекта мы передаем ему нужные координаты и ссылку на файл изображения.

```python
while True:
    .......
    b1.update(20)  # для задействования физики спрайта вызываем 
                    # в цикле событий ранее определенный метод
```

---

Множество однотипных спрайтов принято объединять в группы, для чего предусмотрен базовый класс `pygame.sprite.Group()`. Например, так:

```python
balls = pygame.sprite.Group()
```

Далее, с помощью метода `add` мы добавляем в группу наши спрайты:

```python
balls.add(Ball(W//2, 1, 'images/ball_bear.png'))
balls.add(Ball(W//2-250, 2, 'images/ball_fox.png'),
          Ball(W//2+100, 3, 'images/ball_panda.png'))
```

Затем, в главном цикле для прорисовки всей группы достаточно вызвать метод:

```python
while True:
    ....
    balls.draw(sc)  # в параметре указываем холст (поверхность) для прорисовки 
                     # аналог blit, draw сам берет свойства rect и image объектов
                     # и отрисовывает их на переданной ему поверхности
    balls.update(H)  # вызов стандартного метода группы update вызовет одноимённый метод у всех объектов
```

---

Можно настроить автоматическое добавление объекта в группу при его создании. Для этого воспользуемся методом стандартного класса `pygame.sprite.Sprite` — `add`.

```python
class Ball(pygame.sprite.Sprite):
    def __init__(self, x, speed, surf, group):
        pygame.sprite.Sprite.__init__(self)
        self.image = surf
        self.rect = self.image.get_rect(center=(x, 0))
        self.speed = speed
        self.add(group)  # мы передаем конструктору группу, в которую хотим передать объект
```

Также можно добавить в физику объекта удаление из всех групп (`kill`) или только из одной (`remove`):

```python
def update(self, *args):
    if self.rect.y < args[0] - 20:
        self.rect.y += self.speed
    else:
        self.kill()  # <-----------
```

---

С помощью модуля `pygame.time` можно также генерировать авто-события:

```python
pygame.time.set_timer(pygame.USEREVENT, 2000)
```

Здесь мы указываем, что хотим генерировать особое (пользовательское) событие и период повторения в мс.
Затем, в главном цикле мы будем отслеживать это пользовательское событие и по нему создавать новый спрайт:

```python
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            exit()
        elif event.type == pygame.USEREVENT:
            createBall(balls)  # прописанная нами функция генерации
```

```python
def createBall(group):
    indx = randint(0, len(balls_surf) - 1)
    x = randint(20, W - 20)
    speed = randint(1, 4)
 
    return Ball(x, speed, balls_surf[indx], group)  # мы не генерируем ссылку на спрайт, всё управление 
                                                  # происходит через группу. И как только спрайт 
                                                  # удаляется из неё, то исчезает по причине 
                                                  # отсутствия других ссылок на него.
```

```python
createBall(balls)  # создаем первый объект для группы, чтобы предотвратить ошибку
 
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            exit()
        elif event.type == pygame.USEREVENT:
            createBall(balls)  # настраиваем генерацию
 
    sc.blit(bg, (0, 0))  # отрисовываем фон
    balls.draw(sc)      # отрисовываем группу
    pygame.display.update()  # рендерим кадр
 
    clock.tick(FPS)
 
    balls.update(H)  # задействуем физику группы
```

