#Python #wxPython

# 16. Буферизация графических данных

Пусть изначально в программе не предусмотрена буферизация.

---

```python
class MyFrame(wx.Frame):
    def __init__(self, parent, title):
        super().__init__(parent, title=title, pos=(0, 0), size=(700, 400))
 
        self.Bind(wx.EVT_PAINT, self.OnPaint)
        self.Bind(wx.EVT_SIZE, self.OnResize)
 
    def OnResize(self, e):
        self.Refresh()
 
    def OnPaint(self, e):
        dc = wx.PaintDC(self)
        self.Draw(dc)

    def Draw(self, dc):
        ...процесс отрисовки...
```
---

## СОЗДАНИЕ БУФЕРА

1. **Инициализация**: В конструкторе фрейма инициализируем битмапку (изображение окна приложения) в памяти фрейма, а также создаем экземпляр контекста устройства `MemoryDC` (для отрисовки в памяти) и связываем его с битмапкой.
   
   ```python
   self.btm = wx.Bitmap(wx.GetDisplaySize())
   self.btmDC = wx.MemoryDC()
   self.btmDC.SelectObject(self.btm)
   ```

2. **Отрисовка**: Выносим отрисовку кадра в отдельный обработчик `def DrawIntoBitmap(self):`. Заменяем контекст устройства на `MemoryDC`. Перед отрисовкой (в `DrawIntoBitmap`) сохраняем размеры окна в памяти фрейма.
   
   ```python
   self.sizeBtm = self.GetSize()
   ```

3. **Копирование изображения**: С помощью метода копирования изображения в контекст устройства загружаем готовую битмапку в контекст отрисовки кадра `dc = PaintDC()` в методе `Draw`.
   
   ```python
   def Draw(self, dc):
       dc.Blit(0, 0, self.sizeBtm.width, self.sizeBtm.height, self.btmDC, 0, 0)  # ширину и высоту берем из сохраненных размеров окна
   ```

4. **Начальная отрисовка**: Добавляем начальную отрисовку в конструктор, вызвав `DrawIntoBitmap`.

   ```python
   self.DrawIntoBitmap()
   ```

5. **Обновление битмапки**: Добавляем обновление битмапки при изменении размеров окна.

   ```python
   def OnResize(self, e):
       self.DrawIntoBitmap()
       self.Refresh()
   ```

