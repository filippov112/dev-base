#lang #lang-python 

# 1. Основы и реляционные БД

**Реляционные базы данных** - это базы данных, содержащие таблицы с возможностью связываться между собой.

## Популярные СУБД на Python:
- MySQL
- SQLite
- PostgreSQL

### SQLite
SQLite используется для создания легковесной дисковой БД, то есть эта СУБД **НЕ ПОДДЕРЖИВАЕТ** сетевое взаимодействие (разве что удаленный доступ к файлу БД, но не более того). Также она имеет ограничение при многопользовательском доступе: запись данных может осуществлять только **1 ПОТОК** или процесс в один момент времени. Однако на чтение таких **ОГРАНИЧЕНИЙ НЕТ**.

Все взаимодействие с СУБД происходит с помощью нескольких методов, главным из которых является:

```python
execute(SQL)
```

### Пример подключения к БД

```python
import sqlite3 as sq

con = sq.connect("saper.db")  # подключение БД (в папке с программой)
# расширения: *.db, *.db3, *.sqlite и *.sqlite3
cur = con.cursor()  # В результате создается (или открывается) БД с именем saper.db.
# con - экземпляр объекта Connection
```

Далее, мы должны использовать объект **Cursor** для взаимодействия с БД и выполнения SQL-запросов.

```python
con = sq.connect(':memory:')  # позволяет создавать БД непосредственно в памяти программы без сохранения на устройстве
```

```python
cur.execute(""" """)  # в качестве аргумента курсору передается строка с SQL-запросом.
```

```python
con.close()  # закрыть соединение.
```

### Использование менеджера контекста

Лучше использовать через менеджер контекста:

```python
with sq.connect("saper.db") as con:
    cur = con.cursor()
    cur.execute("""
    """)
```

## Типы данных хранения
- **NULL** – значение NULL;
- **INTEGER** – целочисленный тип (занимает от 1 до 8 байт);
- **REAL** – вещественный тип (8 байт в формате IEEE);
- **TEXT** – строковый тип (в кодировке данных базы, обычно UTF-8);
- **BLOB** – двоичные данные, хранятся «как есть», например, для небольших изображений.

### Форматирование SQL-запросов
Названия команд и типов принято писать заглавными буквами, а имена таблиц и их полей – строчными.

```python
cur.execute("""CREATE TABLE IF NOT EXISTS users (  -- генерация таблицы users (IF NOT EXISTS если её ещё нет)
    name TEXT,
    sex INTEGER,
    old INTEGER,
    score INTEGER
)""")
```
При добавлении новой записи обязательно нужно будет указывать имя игрока (`name TEXT NOT NULL`), но можно не указывать его пол, если предполагается мужской (`sex INTEGER DEFAULT 1`).

```sql
cur.execute("DROP TABLE users")  -- удаление таблицы
```

## Команды SQL Browser
- `SELECT * FROM users`  - выбор записи (* - всех записей сразу)
- `SELECT rowid, * FROM users` - отображение поля идентификаторов для всех записей таблицы

## Свои идентификаторы
```sql
user_id INTEGER PRIMARY KEY AUTOINCREMENT
```
- **PRIMARY KEY** (первичный ключ) означает, что поле `user_id` должно содержать уникальные значения.
- **AUTOINCREMENT** указывает СУБД автоматически увеличивать значение `user_id` при добавлении новой записи.
