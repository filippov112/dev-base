#Python #sqlite

# 5. Агрегирование и группировка

```sql
SELECT count(user_id) FROM games WHERE user_id = 1
```

- `count()` - можно не указывать параметр столбца.
- `count() as count` - для удобства можно переименовать новый столбец.

**Возвращаемые данные**: 1 запись из 1 столбца, в которой содержится полученное значение.

## Агрегаторы, доступные через SELECT:
- `count()` – подсчет числа записей.
- `sum()` – сумма по всем записям выборки.
- `avg()` – среднее арифметическое.
- `min()` – минимальное значение.
- `max()` – максимальное значение.

```sql
SELECT DISTINCT user_id FROM games
```
- Выборка только записей с уникальным значением поля `user_id`.

## Группировка
**GROUP BY** - формирование групп по значениям в столбце:

```sql
GROUP BY <имя поля>
SELECT user_id, sum(score) as sum FROM games GROUP BY user_id
```

При указании в конце `SELECT` "GROUP BY <имя поля>", агрегаторы будут работать в пределах групп.

## Условия и фильтрация
**WHERE** - фильтр для выбираемых записей:

```sql
SELECT col1,… FROM <table_name> WHERE <условие>
```

**Оффтоп**: `"value BETWEEN 500 AND 1000"` - условие диапазона.

## Сортировка
**ORDER BY** - сортировка (возрастание):

```sql
SELECT col1,… FROM <table_name> WHERE <условие> ORDER BY <поле>
ORDER BY <поле> DESC	-- обратная сортировка
```

## Ограничение выборки
**LIMIT** - ограничение выборки:

```sql
LIMIT <max> OFFSET <offset>
```
или
```sql
LIMIT <offset, max>
```

```sql
SELECT col1,… FROM <table_name> WHERE <условие> ORDER BY <поле> LIMIT <offset, max>
```
- `max` - число записей.
- `offset` - пропуск N первых записей (необязательный параметр).

## Условия
```sql
name LIKE 'Федор' 
```
- Возвращает `True`, если в `name` присутствует строка 'Федор'.

### Шаблоны строк
- `%` - любое продолжение строки.
- `_` - любой символ.
