#lang #lang-python #flask 

---
```python
import sqlite3
import os  # импортируются модули для работы с БД и файловой системой
# ...(импорт всего остального)

DATABASE = '/tmp/flsite.db'  # с заглавных букв прописываем св-ва конфигурации для WSGI-приложения
DEBUG = True
SECRET_KEY = 'fdgfh78@#5?>gfhf89dx,v06k'  # шифровка куки файлов приложения

app = Flask(__name__)
app.config.from_object(__name__)  # после создания приложения загружаем в него данные конфиг. из текущего файла

app.config.update(dict(DATABASE=os.path.join(app.root_path,'flsite.db')))
# переопределим в конфигурации значение DATABASE, расположив БД в текущем каталоге приложения
```

## Функции для работы с базой данных

### Подключение к базе данных
```python
def connect_db():  # функция для установления соединения с БД
    conn = sqlite3.connect(app.config['DATABASE'])
    conn.row_factory = sqlite3.Row
    return conn
# здесь мы генерируем файл БД в каталоге приложения
```

### Создание базы данных
```python
def create_db():  # функция для создания таблиц БД
    db = connect_db()
    with app.open_resource('sq_db.sql', mode='r') as f:  # .open_resource - аналог open из pickle
        db.cursor().executescript(f.read())  # мы не присваиваем ссылку на курсор, он нам больше не нужен
    db.commit()
    db.close()
# здесь мы прописываем нужные таблицы в созданном ранее файле БД
```

### Получение соединения с базой данных
```python
def get_db():  # функция проверки наличия и установки соединения с БД для обработчиков
    if not hasattr(g, 'link_db'):
        g.link_db = connect_db()
    return g.link_db
# здесь мы взаимодействуем с переменной g контекста приложения, которую необходимо импортировать так же, как request
```

### Закрытие соединения с базой данных
```python
@app.teardown_appcontext  # данный декоратор автоматически вызывает функцию в момент удаления контекста приложения
def close_db(error):  # функция закрытия соединения с БД, установленного в g-контексте приложения
    '''Закрываем соединение с БД, если оно было установлено'''
    if hasattr(g, 'link_db'):
        g.link_db.close()
```

---

## Пример использования в обработчике

```python
@app.route("/")
def index():
    db = get_db()
    return render_template('index.html', menu=[])
```
