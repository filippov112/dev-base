#Django #Python

# 15. Классы представлений. ListView

Давайте, для начала, заменим функцию представления `index` (файл `women/views.py`) на класс. Так как у нас на главной странице отображается список статей, то здесь подойдет уже заготовленный для этих целей базовый класс `ListView`.

```python
from django.views.generic import ListView

class WomenHome(ListView):
    model = Women
    template_name = 'women/index.html'
    context_object_name = 'posts'  # меняем имя объекта object_list
    extra_context = {'title': 'Главная страница'}  # Для передачи шаблону статических данных

    allow_empty = False  # генерирует исключение при отсутствии записей

    # Для передачи более сложных данных можно переопределить базовый метод
    def get_context_data(self, *, object_list=None, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = 'Главная страница'
        context['cat_selected'] = 0
        context['menu'] = menu  # объект context включает в себя в том числе объект object_list
        # Пример обращения
        # context['posts'][0].title
        return context

    # Для настройки выборки записей из таблицы переопределим метод
    def get_queryset(self):
        return Women.objects.filter(is_published=True)
```

Фактически, строчка `model = Women` выберет все записи из таблицы `women` и попытается отобразить их в виде списка, используя шаблон с именем:

```
<имя приложения>/<имя модели>_list.html
```

Данные из модели `Women`, указанной в классе представлений, помещаются в коллекцию `object_list` для работы с ними в шаблоне.

### Связываем маршрут главной страницы с классом `WomenHome`

```python
path('', WomenHome.as_view(), name='home')  # метод as_view() нужно ВЫЗВАТЬ
```

При указании переменной в динамическом URL класс представления автоматически забирает ее. После чего к ней можно обратиться через словарь `kwargs`:

```python
path('category/<slug:cat_slug>/', WomenCategory.as_view(), name='category')
self.kwargs['cat_slug']
```

Через `"__"` можно обращаться к полям таблицы в фильтре:

```python
def get_queryset(self):
    return Women.objects.filter(cat__slug=self.kwargs['cat_slug'])
```
