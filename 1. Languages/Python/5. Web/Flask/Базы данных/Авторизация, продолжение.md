#Python #Flask #db

# Авторизация, продолжение

- **current_user.get_id()** — через переменную `current_user` можно обращаться к методам "инструмента".
- **logout_user()** — выход из аккаунта. Удаление "инструмента".
- **login_user(userlogin, remember=rm)** — через параметр `remember` можно управлять запоминанием пользователя при следующей сессии.

```python
login_manager.login_view = 'login'
```
- Указание имени обработчика авторизации для перенаправления с закрытых страниц сайта.

```python
login_manager.login_message = "Авторизуйтесь для доступа к закрытым страницам"
```
- Флеш-уведомление при перенаправлении.

```python
login_manager.login_message_category = "success"
```
- Категория уведомления при перенаправлении.

---

```python
if current_user.is_authenticated:
    return redirect(url_for('profile'))
```
- Проверка авторизованности при переходе на страницу авторизации и перенаправление на страницу профиля.

---

```html
<form action="" method="post" class="form-contact">
```
- Если адрес обработчика не указан, то форма автоматически направляет запрос по адресу страницы, на которой она находится. В адресе этой страницы присутствует параметр `next` в случае перенаправления. В этом параметре хранится адрес предыдущей страницы.

```python
if current_user.is_authenticated:
    return redirect(request.args.get("next") or url_for("profile"))
```
- Таким образом, если пользователь попал на страницу авторизации через перенаправление, то после авторизации он попадет на предыдущую страницу.

---

### Наследование от UserMixin

При наследовании "инструмента" от вспомогательного класса `UserMixin` отпадает необходимость прописывать дополнительные методы:

```python
def is_authenticated(self):
    return True

def is_active(self):
    return True

def is_anonymous(self):
    return False
```

И внешний вид "инструмента" сокращается:

```python
class UserLogin(UserMixin):
    def fromDB(self, user_id, db):
        self.__user = db.getUser(user_id)
        return self

    def create(self, user):
        self.__user = user
        return self

    def get_id(self):
        return str(self.__user['id'])
```

