 #lang #lang-python

## 2. MTV, маршрутизация, функции представления

**Паттерн MTV** - разделение на данные (model), шаблоны (templates) и представления (views).  
То есть, разделение данных и HTML-шаблонов.

Каждая логически и функционально независимая часть сайта предполагает его реализацию в виде отдельного приложения. Приложения в Django следует реализовывать максимально независимыми.

---

### 1. Инициализация приложения через терминал:

```bash
python manage.py startapp имя_приложения
```

После выполнения команды у нас в проекте появилась еще одна папка – `имя_приложения`, которая уже содержит несколько файлов и файл `__init__.py`. Следовательно, приложение в Django реализуется как ПАКЕТ.

- `migrations` - для хранения миграций БД нашего приложения.
- `admin.py` – для настройки админ-панели сайта (админ-панель поставляется совместно с Django и каждый сайт может сразу ее использовать).
- `apps.py` – для настройки (конфигурирования) текущего приложения.
- `models.py` – для хранения ORM-моделей для представления данных из базы данных.
- `tests.py` – модуль с тестирующими процедурами.
- `views.py` – для хранения представлений (контроллеров) текущего приложения.

---

### 2. Регистрация приложения в проекте

После создания приложения его необходимо зарегистрировать в проекте нашего сайта. Для этого нужно перейти в пакет конфигурации (ПК) сайта (первая папка в корневом каталоге), открыть файл `settings.py` и в списке `INSTALLED_APPS` прописать новое приложение:

```python
имя_приложения.apps.Имя_приложенияConfig
```

---

### 3. Реализация представлений сайта

Представления сайта можно реализовывать в виде функций либо классов. На примере функции (прописываем в `views.py`):

```python
from django.http import HttpResponse

# request - содержит информацию о запросе, о сессии, о куках и так далее

def index(request):
    return HttpResponse("Какой-то текст")
```

---

### 4. Связывание функции представления с URL-адресом

#### На прямую - не правильно

Для этого в ПК откроем файл `urls.py` и в список адресов `urlpatterns` добавим новый путь с помощью функции `path`:

```python
urlpatterns = [
    # ...,
    path('имя_приложения/', index)
]
```

Предварительно нужно импортировать эту функцию:

```python
from имя_приложения.views import index
```

В случае `not_found`:

ПКМ-корневой каталог сайта -> Mark Directory as -> Source Root (указываем рабочую директорию)

---

#### Локально

1. Создаем файл с адресами в каталоге приложения - `urls.py`:

    ```python
    from django.urls import path  # импортируем функцию path
    from .views import *  # импортируем представления

    urlpatterns = [
        path('', index),
    ]
    ```

2. В ПК откроем файл `urls.py`:

    ```python
    from django.urls import path, include  # импортируем include

    urlpatterns = [
        # ...,
        path('имя_приложения/', include('имя_приложения.urls'))
    ]
    ```
    - Если приложение основное, URL оставляем пустым `''`.
