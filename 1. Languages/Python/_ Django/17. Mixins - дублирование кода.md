#lang #lang-python  

# 17. Mixins - дублирование кода

(Смотри подробности в `python/ООП/дочерние классы/множественное наследование`)

В Python, благодаря наличию механизма множественного наследования, примеси можно добавлять в виде отдельного базового класса. Например, наши классы представлений можно дополнительно унаследовать от класса `DataMixin`, который мы отдельно определим. 

Причем, этот класс лучше прописывать первым в списке наследования:

> Обычно, в Django все дополнительные, вспомогательные классы объявляют в отдельном файле приложения `utils.py`.

## Пример класса представления

```python
class WomenHome(DataMixin, ListView):  # пример класса представления (тип - наследник ListView)
    ...
```

## Пример класса миксина

```python
from .models import *

menu = [...]

class DataMixin:  # пример класса миксина
    def get_user_context(self, **kwargs):  # миксины могут хранить как общие методы так и атрибуты
        context = kwargs  # миксин может также принимать дополнительные свойства в процессе работы
        cats = Category.objects.all()  # Миксин может сам брать данные из БД
        context['menu'] = menu  # Создавать и хранить общие свойства
        context['cats'] = cats
        if 'cat_selected' not in context:
            context['cat_selected'] = 0
        return context
```

## Объединение контекстов

```python
def get_context_data(self, *, object_list=None, **kwargs):
    context = super().get_context_data(**kwargs)
    c_def = self.get_user_context(title="Главная страница")  # инициализируем переменную с возвращаемыми свойствами метода миксина
    context = dict(list(context.items()) + list(c_def.items()))  # объединяем 2 словаря (основной и от миксина)
    return context
```

---

В Django есть стандартные миксины, которые можно использовать совместно с классами представлений. Например:

- **`LoginRequiredMixin`** - позволяет ограничить доступ к странице для неавторизованных пользователей.

```python
from django.contrib.auth.mixins import LoginRequiredMixin

class AddPage(LoginRequiredMixin, DataMixin, CreateView):
    login_url = reverse_lazy('home')  # определяет страницу перенаправления (можно записывать конкретный URL)
    ...
```
