 #lang #lang-python #django 

---
> Фреймворк Django имеет три специальных класса для организации связей:
> - `ForeignKey` – для связей **Many to One** (поля отношений);
> - `ManyToManyField` – для связей **Many to Many** (многие ко многим);
> - `OneToOneField` – для связей **One to One** (один к одному).

---

### ForeignKey

> Класс `ForeignKey` принимает два обязательных аргумента:
> - Ссылка или строка класса модели, с которой происходит связывание.
> - Опция `on_delete`, накладывающая ограничения при удалении внешней записи.
> 
> #### Возможные значения `on_delete`:
> - `models.CASCADE` – при удалении записи из первичной модели, происходит удаление всех записей из вторичной модели, связанных с удаляемой категорией.
> - `models.PROTECT` – запрещает удаление записи из первичной модели, если она используется во вторичной (выдает исключение).
> - `models.SET_NULL` – при удалении записи первичной модели устанавливает значение foreign key в `NULL` у соответствующих записей вторичной модели.
> - `models.SET_DEFAULT` – аналогично `SET_NULL`, но вместо значения `NULL` устанавливает значение по умолчанию, которое должно быть определено через класс ForeignKey.
> - `models.SET()` – аналогично, но устанавливает пользовательское значение.
> - `models.DO_NOTHING` – удаление записи в первичной модели не вызывает никаких действий у вторичных моделей.

---

#### Пример использования ForeignKey:

1. **Создаём первичный класс**
`db_index` указывает СУБД индексировать данное поле, чтобы поиск по нему происходил быстрее.

```python
class Category(models.Model):
    name = models.CharField(max_length=100, db_index=True)

    def __str__(self):
        return self.name
```


---

2. **Добавляем дополнительное поле к модели вторичного класса (таблицы)**

```python
cat = models.ForeignKey('Category', on_delete=models.PROTECT)
```

- Класс первичной категории можно указывать и без кавычек.
- Суффикс `_id` Django добавит автоматически — `cat_id`.

Если в таблице уже были записи, нужно дать разрешение на нулевое значение поля для таких случаев:
```python
cat = models.ForeignKey('Category', on_delete=models.PROTECT, null=True)
```
Это своего рода "костыль", чтобы обработать существующие записи.

---

3. **Создаём миграции с внесёнными правками**

- Выполняем создание и применение миграций:
    ```bash
    python manage.py makemigrations
    python manage.py migrate
    ```

- Добавляем записи в первичную таблицу:
    ```bash
    Category.objects.create(name='Актрисы')
    ```

- Устанавливаем привязки записям вторичной таблицы:
    ```bash
    w_list = Women.objects.all()
    w_list.update(cat_id=0)
    ```
