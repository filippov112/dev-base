#lang #lang-c_sharp #efcore 

---
По умолчанию запросы EF Core, возвращающие объекты моделей, **отслеживаются**.  
Контекст данных кэширует извлечённые объекты и отслеживает их изменения до вызова `SaveChanges()`/`SaveChangesAsync()`.  
Если изменения объектов не нужны (например, только для чтения), ==лучше использовать **неотслеживаемые запросы** для повышения производительности.==  

---
#### **Метод `AsNoTracking()`**  
- Применяется к `IQueryable`.  
- Отключает кэширование и отслеживание изменений объектов.  
- Уменьшает нагрузку на память и ускоряет выполнение запросов.  

```csharp
var user = db.Users.AsNoTracking().FirstOrDefault();  // Изменения в `user` не сохранятся в БД, даже после `SaveChanges()`.  
```  

---
#### **Глобальное отключение отслеживания**  
**Через свойство `ChangeTracker`**

- На уровне экземпляра контекста:
  ```csharp
	// using ApplicationContext db ...
  db.ChangeTracker.QueryTrackingBehavior = QueryTrackingBehavior.NoTracking;  
  ```  
- На уровне класса контекста (в конструкторе):  
  ```csharp
  public ApplicationContext()  
  {  
      ChangeTracker.QueryTrackingBehavior = QueryTrackingBehavior.NoTracking;  
  }  
  ```  
- Можно получить количество отслеживаемых объектов:  
  ```csharp
  int count = db.ChangeTracker.Entries().Count();  
  ```  
---
### Outer links:
https://metanit.com/sharp/efcore/5.7.php