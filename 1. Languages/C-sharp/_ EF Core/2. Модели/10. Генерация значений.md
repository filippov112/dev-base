#lang #lang-c_sharp 
# <font color="#00b0f0">EF Core:</font> Генерация значений

Если значение не задано, применяется значение **по умолчанию**:  
  - `null` для nullable-типов,  
  - `0` для `int`,  
  - `Guid.Empty` для `Guid` и т.д.  

Значения могут генерироваться:  
  - **На стороне клиента** (EF Core).  
  - **На стороне БД** (временное значение заменяется при вызове `SaveChanges()`).  

**Генерация первичных ключей**  
По умолчанию для `int` и `Guid`-ключей со значением по умолчанию EF Core генерирует значения при вставке.  
  ```csharp
  public class User
  {
      public int Id { get; set; }  // Автогенерация (Identity)
      public string? Name { get; set; }
  }
  ```
---
#### **Настройка через атрибуты**  
- **`DatabaseGeneratedAttribute`** – контролирует генерацию значений БД.  
  - **`DatabaseGeneratedOption.None`** – отключает автогенерацию:  
  - **`DatabaseGeneratedOption.Identity`** – явное включение автогенерации (избыточно для ключей).  
```csharp
[DatabaseGenerated(DatabaseGeneratedOption.None)]
public int Id { get; set; }  // Требуется ручное задание Id
```
---
#### **Настройка через Fluent API**  
- **Отключение автогенерации**:  
  ```csharp
  modelBuilder.Entity<User>().Property(u => u.Id).ValueGeneratedNever();
  ```
- **Значение по умолчанию**:  
  ```csharp
  modelBuilder.Entity<User>().Property(u => u.Age).HasDefaultValue(18);
  ```

  ```csharp
  modelBuilder.Entity<User>()
      .Property(u => u.CreatedAt)
      .HasDefaultValueSql("DATETIME('now')");  // Для SQLite
  ```
- **Вычисляемые столбцы**:
  ```csharp
  modelBuilder.Entity<User>()
      .Property(u => u.Name)
      .HasComputedColumnSql("FirstName || ' ' || LastName");
  ```

---
### Outer links:
https://metanit.com/sharp/efcore/2.8.php