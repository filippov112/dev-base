#lang #lang-c_sharp 
# <font color="#00b0f0">EF Core:</font> Индексы

По умолчанию EF Core создает индексы для:  
  - Первичных ключей (`Id`).  
  - Внешних ключей (навигационные свойства).  

Дополнительные индексы можно настроить вручную.  

---

#### **Атрибуты (`[Index]`)**  
Пространство имен: `Microsoft.EntityFrameworkCore`  

**Пример простого индекса:**  
```csharp
[Index("PhoneNumber")]
public class User
{
    public int Id { get; set; }
    public string? PhoneNumber { get; set; }
}
```  

**Составной индекс (несколько свойств):**  
```csharp
[Index("PhoneNumber", "Passport")]
public class User { ... }
```  

**Настройка уникальности и имени индекса:**  
```csharp
[Index("PhoneNumber", IsUnique = true, Name = "Phone_Index")]
public class User { ... }
```  
- `IsUnique = true` – гарантирует уникальность значений.  
- `Name` – задает имя индекса в БД.  

---

#### **Fluent API**  
Используется метод `HasIndex()` в `OnModelCreating()`.  

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<User>().HasIndex(u => u.Passport);
}
```  

**Уникальный индекс:**  
```csharp
modelBuilder.Entity<User>().HasIndex(u => u.Passport).IsUnique();
```  

**Составной индекс:**  
```csharp
modelBuilder.Entity<User>().HasIndex(u => new { u.Passport, u.PhoneNumber });
```  

**Указание имени индекса:**  
```csharp
modelBuilder.Entity<User>()
    .HasIndex(u => u.PhoneNumber)
    .HasDatabaseName("PhoneIndex");
```  

**Фильтрация индексов (частичные индексы):**  
```csharp
modelBuilder.Entity<User>()
    .HasIndex(u => u.PhoneNumber)
    .HasFilter("[PhoneNumber] IS NOT NULL");
```  
- Применяется только к строкам, где `PhoneNumber` не `NULL`.  
- Поддерживается не всеми СУБД (например, SQLite, SQL Server).  

---
### Outer links:
https://metanit.com/sharp/efcore/2.17.php