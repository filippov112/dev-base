#lang #lang-c_sharp 
# <font color="#00b0f0">EF Core:</font> Сущности

---
### <font color="#7030a0">**Включение сущностей в модель** </font> 

##### 1. **С помощью `DbSet`**
По умолчанию EF Core включает в модель все сущности, для которых в контексте данных (`DbContext`) определены свойства `DbSet<T>`.  

  ```csharp
  public class ApplicationContext : DbContext
  {
      public DbSet<User> Users { get; set; } = null!; // Сущность User включается в модель
  }
  ```

> [!note] **`DbSet` и nullable-типы (C# 10 / .NET 6+)**  
> `DbSet` – ссылочный тип, и при включении nullable-проверок (`<Nullable>enable</Nullable>`) требуется инициализация.  
> - **Способы инициализации:**  
> ```csharp
> public DbSet<User> Users { get; set; } = null!;
> ```
> ```csharp
> public DbSet<User> Users => Set<User>();
> ```  

##### 2. **Через ссылки в других сущностях**  
EF Core автоматически включает в модель сущности, на которые есть ссылки в других сущностях (например, через **навигационные свойства**).  

  ```csharp
  // Если `User` добавлен в `DbSet`, то `Company` также попадет в модель, даже без `DbSet<Company>`.  
  public class User
  {
      public int Id { get; set; }
      public Company? Company { get; set; } // Company включается в модель
  }
  ```

##### 3. **Через `Fluent API`**  
Можно добавить сущность в модель через метод `Entity<T>()` в `OnModelCreating`:  
  ```csharp
  protected override void OnModelCreating(ModelBuilder modelBuilder)
  {
      modelBuilder.Entity<Country>(); // Добавляет Country в модель
  }
  ```  
---
### <font color="#7030a0">**Исключение сущностей из модели** </font> 
При исключении сущности:  
Таблица в БД не создается.  
Навигационные свойства, ссылающиеся на исключенную сущность, игнорируются.  

  ##### 1. **Fluent API** – метод `Ignore<T>()`:  
 ```csharp
 modelBuilder.Ignore<Company>();
 ```  
  ##### 2. **Аннотации данных** – атрибут `[NotMapped]`:  
 ```csharp
 [NotMapped]
 public class Company { ... }
 ```  
---
### Outer links:
https://metanit.com/sharp/efcore/2.3.php