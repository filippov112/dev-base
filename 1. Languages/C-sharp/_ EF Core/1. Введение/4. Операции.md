#lang #lang-c_sharp #efcore

---
1. CRUD методы - меняют состояние объекта.
2. `SaveChanges()` / `SaveChangesAsync()` - генерирует команду/запрос к БД, на основе состояния.

#### CRUD
- <font color="#de7802">Вставка</font> - `Add(obj)` / `AddRange(obj1, obj2, ...)` / `AddAsync()` / `AddRangeAsync()`;
	```csharp
	using (ApplicationContext db = new ApplicationContext())
	{
	    User tom = new User { Name = "Tom", Age = 33 };
	    User alice = new User { Name = "Alice", Age = 26 };

	    db.Users.Add(tom);
	    db.Users.Add(alice);
	    db.SaveChanges();
		// or async
		await db.Users.AddRangeAsync(tom, alice);
	    await db.SaveChangesAsync();
	}
	```

- <font color="#de7802">Чтение</font>
	```csharp
	using (ApplicationContext db = new ApplicationContext())
	{
		User? user = db.Users.FirstOrDefault();
	    var users = db.Users.ToList();
	    // or async
	    User? user = await db.Users.FirstOrDefaultAsync();
	    var users = await db.Users.ToListAsync();
	}
	```

- <font color="#de7802">Удаление</font> - `Remove(obj)` / `RemoveRange(obj1, obj2, ...)`;
	```csharp
	using (ApplicationContext db = new ApplicationContext())
	{
	    // User? user = db.Users.FirstOrDefault();
	    if (user != null)
	    {
	        db.Users.Remove(user);
	        db.SaveChanges();
	    }
	}
	```

- <font color="#de7802">Изменение</font> (требуется только за пределами контекста) - `Update(obj)` / `UpdateRange(obj1, obj2, ...)`
	```csharp
	using (ApplicationContext db = new ApplicationContext())
	{
	    //User? user = db.Users.FirstOrDefault();
	    if (user != null)
	    {
	        user.Name = "Bob";
	        user.Age = 44;
	        //db.Users.Update(user); // если за пределами using
	        db.SaveChanges();
	    }    
	}
	```


### Outer links:
https://metanit.com/sharp/efcore/1.4.php