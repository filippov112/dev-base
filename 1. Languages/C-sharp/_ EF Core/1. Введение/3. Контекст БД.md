#lang #lang-c_sharp

---
Для подключения к базе создаем **класс контекста данных** (потомок `DbContext`).
Подключение моделей (таблиц) - `DbSet`/`DbSet<TEntity>`
Опции подключения - `DbContextOptionsBuilder` 

Дополнительно:
- [Драйверы, конфиги, пакеты](1.%20Languages/C-sharp/_%20EF%20Core/_/Драйверы,%20конфиги,%20пакеты.md)
- [EnsureCreated, EnsureDeleted, CanConnect](1.%20Languages/C-sharp/_%20EF%20Core/_/EnsureCreated,%20EnsureDeleted,%20CanConnect.md)

### Способы передачи конфигурации подключения в контекст БД:
---
1. <font color="#e36c09">Передача строкой через `OnConfiguring()`.</font>
	```csharp
	// DbContext.cs
	public class ApplicationContext : DbContext
	{
	    public string connString;
	    public ApplicationContext(string _str)
	    {
	        this.connString = _str;
	    }
	    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
	    {
	        optionsBuilder.UseSqlite(connString); // Или метод для другой субд
	    }
	}
	```
	[Если храним конфигурацию в appsettings.json](1.%20Languages/C-sharp/_%20EF%20Core/_/appsettings.json.md)
	```csharp
	// Programm.cs
	using (ApplicationContext db = new ApplicationContext("Data Source=helloapp.db"))
	{
	//...
	}
	```
---
2. <font color="#e36c09">Строкой через базовый конструктор `DbContext`.</font>
	```csharp
	// DbContext.cs
	public class ApplicationContext : DbContext
	{
	    public ApplicationContext(DbContextOptions<ApplicationContext> options): base(options)
	    {
	    }
	}
	```
	```csharp
	// Programm.cs
	var optionsBuilder = new DbContextOptionsBuilder<ApplicationContext>();
	var options = optionsBuilder.UseSqlite("Data Source=helloapp.db").Options;
	 
	using (ApplicationContext db = new ApplicationContext(options))
	{
	//...
	}
	```
---
3. <font color="#e36c09">JSON-конфигом через `OnConfiguring()`.</font>
	```json
	// appsettings.json
	{
	  "ConnectionStrings": {
	    "DefaultConnection": "Data Source=helloapp.db"
	  }
	}
	```
	```csharp
	// DbContext.cs
	using Microsoft.Extensions.Configuration;
	
	public class ApplicationContext : DbContext
	{
	    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
	    {
	        var config = new ConfigurationBuilder()
	                        .AddJsonFile("appsettings.json")
	                        .SetBasePath(Directory.GetCurrentDirectory())
	                        .Build();
	 
	        optionsBuilder.UseSqlite(config.GetConnectionString("DefaultConnection"));
	    }
	}
	```
	```csharp
	// Programm.cs
	using (ApplicationContext db = new ApplicationContext())
	{
	//...
	}
	```

### Outer links:
https://metanit.com/sharp/efcore/1.5.php