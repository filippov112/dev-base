#lang #lang-c_sharp #efcore 

---
**TPC (Table Per Concrete Type)** — стратегия, где для каждого конкретного типа создаётся отдельная таблица.
<u>Все свойства</u> (включая унаследованные) хранятся в таблице соответствующего типа.
- **Преимущества перед TPT**:
  - Меньше JOIN-операций (используется `UNION ALL`), что ускоряет запросы.
  - Нет общей таблицы для базового класса (в отличие от TPT).

Для применения TPC используется метод `UseTpcMappingStrategy()` в `OnModelCreating`.
```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder) {
	modelBuilder.Entity<User>().UseTpcMappingStrategy();
}
```

Создаются отдельные таблицы для каждого типа:
```sql
CREATE TABLE "Users" ("Id" TEXT PRIMARY KEY, "Name" TEXT);
CREATE TABLE "Employees" ("Id" TEXT PRIMARY KEY, "Name" TEXT, "Salary" INTEGER);
CREATE TABLE "Managers" ("Id" TEXT PRIMARY KEY, "Name" TEXT, "Departament" TEXT);
```

**Ограничения**
- Нет общей таблицы для генерации `Id` (в отличие от TPT).
- Риск конфликтов `Id` при неправильной настройке стратегии.
- Поддержка зависит от провайдера БД (например, SQLite не поддерживает sequences).

#### **5. Стратегии генерации идентификаторов**
Все сущности в иерархии должны иметь уникальные `Id`, даже если типы разные.

  1. **Явная установка** (например, GUID):
     ```csharp
     public string Id { get; set; } = Guid.NewGuid().ToString();
     ```
  2. **Последовательности (Sequences)**:
     - Используется по умолчанию для SQL Server.
     - Пример для SQL Server:
       ```sql
       CREATE TABLE [Users] (
           [Id] int NOT NULL DEFAULT (NEXT VALUE FOR [UserSequence]),
           ...
       );
       ```
  3. **Идентификаторы с шагом**:
     - Настройка через `UseIdentityColumn(startValue, increment)`:
       ```csharp
       modelBuilder.Entity<User>().ToTable("Users", tb => tb.Property(e => e.Id).UseIdentityColumn(1, 1));
       modelBuilder.Entity<Employee>().ToTable("Employees", tb => tb.Property(e => e.Id).UseIdentityColumn(10000, 1));
       ```
     - Важно: Не все СУБД поддерживают эту возможность.

---
### Outer links:
https://metanit.com/sharp/efcore/4.3.php