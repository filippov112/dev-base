#lang #lang-c_sharp 

---
**TPH (Table Per Hierarchy)** – стратегия (по умолчанию) для работы с наследованием, при которой все классы иерархии хранятся в **одной таблице**.  
Для определения типа объекта используется **дискриминатор** (столбец `Discriminator`) - автоматически заполняется именем класса.  

Можно явно добавить в класс `User` как свойство, но оно будет **readonly**:
```csharp
public string? Discriminator { get; set; }
```  

В EF Core 7+ можно **явно задать стратегию**:  
```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<User>().UseTphMappingStrategy();
}
```  

---
#### Пример  

```csharp
public class User
{
    public int Id { get; set; }
    public string? Name { get; set; }
}

public class Employee : User
{
    public int Salary { get; set; }
}

public class Manager : User
{
    public string? Departament { get; set; }
}
```  

```csharp
public class ApplicationContext : DbContext
{
    public DbSet<User> Users { get; set; } = null!; 
    public DbSet<Employee> Employees { get; set; } = null!;
    public DbSet<Manager> Managers { get; set; } = null!;
    // ...
}
```  

```sql
CREATE TABLE "Users" (
    "Id" INTEGER NOT NULL,
    "Name" TEXT,
    "Discriminator" TEXT NOT NULL,  -- Определяет тип (User, Employee, Manager)
    "Salary" INTEGER,               -- Свойство Employee
    "Departament" TEXT,             -- Свойство Manager
    CONSTRAINT "PK_Users" PRIMARY KEY("Id" AUTOINCREMENT)
);
```  

```csharp
// Выборка данных
var users = db.Users.ToList();      // Все пользователи
var employees = db.Employees.ToList(); // Только Employee
```  
---
### Outer links:
https://metanit.com/sharp/efcore/4.1.php