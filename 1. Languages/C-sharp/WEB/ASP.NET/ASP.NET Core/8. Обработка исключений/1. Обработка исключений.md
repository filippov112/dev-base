#Csharp #ASP

# 1. Обработка исключений в ASP.NET Core

---
### DeveloperExceptionPageMiddleware
Выводит информацию об исключении в браузер.
Используется в режиме разработки.
Включен по умолчанию, выключать для продакшена не нужно, стоит условие проверки при сборке.

- Метод подключения (чисто для справки) - `UseDeveloperExceptionPage()`.

---

### ExceptionHandlerMiddleware
Обрабатывает исключение или перенаправляет запрос на другой адрес.
Используется для продакшена.

- Метод подключения - `UseExceptionHandler()`.
- Имеет 2 перегрузки: С маршрутом перенаправления и с делагатом `IApplicationBuilder`.
- Следует помещать ближе к началу конвейера.

```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.Environment.EnvironmentName = "Production";
if (!app.Environment.IsDevelopment()) // Если в продакшене находимся
{
	// Через маршрут перенаправления
    app.UseExceptionHandler("/Error");

	// Через собственный делегат IApplicationBuilder
	app.UseExceptionHandler(app => app.Run(async context =>
    {
        context.Response.StatusCode = 500;
        await context.Response.WriteAsync("Error 500. DivideByZeroException occurred!");
    }));
}
 
app.Map("/error", app => app.Run(async context =>
{
    context.Response.StatusCode = 500;
    await context.Response.WriteAsync("Error 500. DivideByZeroException occurred!");
}));

app.Run(async (context) =>
{
    int a = 5;
    int b = 0;
    int c = a / b; // генерим исключение
    await context.Response.WriteAsync($"c = {c}");
});
 
app.Run();
```

### Outer links:
https://metanit.com/sharp/aspnet6/9.1.php