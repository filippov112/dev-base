#Csharp #ASP 
# <font color="#00b0f0">ASP.NET:</font> Конфигурация CORS

**Политика CORS** — это именованное правило, определяющее, какие кросс-доменные запросы разрешены. 
Используется для настройки доступа к API из других доменов (frontend-приложений, мобильных клиентов и т.п.).
Позволяет:
- явно разрешать или запрещать доступ по источникам, методам, заголовкам
- задавать разные правила для разных частей приложения
- централизованно управлять доступом через _CorsOptions_

📌 Политику можно применять:
- глобально через `app.UseCors(...)`
- на уровне endpoint: `app.MapGet(...).RequireCors("FrontendPolicy")`
- через атрибут `[EnableCors("FrontendPolicy")]` (для контроллеров)

---
### ⚙️ `CorsOptions`

**`CorsOptions`** — объект конфигурации, через который добавляются политики.
Каждая политика имеет уникальное имя и создаётся через `CorsPolicyBuilder`.

```csharp
builder.Services.AddCors(options =>
{
    // options — это CorsOptions
    options.AddPolicy("MyPolicy", policy => {
        // policy — это CorsPolicyBuilder
        policy.WithOrigins("http://localhost:3000")
              .WithMethods("GET", "POST")
              .WithHeaders("Content-Type")
              .AllowCredentials();
    });
});
```

---
### 🧱 `CorsPolicyBuilder`

**`CorsPolicyBuilder`** — вспомогательный класс для пошагового построения CORS-политики. 
Используется в `AddCors()` при регистрации политики.

Применяется для указания допустимых:
- источников (`WithOrigins`)
- методов (`WithMethods`)
- заголовков (`WithHeaders`)
- кросс-доменных заголовков (`ExposeHeaders`)
- использования cookies/авторизации (`AllowCredentials`)

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("CustomCorsPolicy", policy =>
    {
        policy.WithOrigins("http://localhost:3000")          // разрешённый origin
              .WithMethods("GET", "POST")                    // разрешённые HTTP-методы
              .WithHeaders("Content-Type", "Authorization") // разрешённые заголовки запроса
              .ExposeHeaders("X-Custom-Header")              // заголовки, доступные клиенту
              .AllowCredentials();                           // разрешить куки / авторизацию
    });
});

app.UseCors("CustomCorsPolicy");
```

**Методы:**
- `WithOrigins(string origins)` — разрешает указанные домены.
- `AllowAnyOrigin()` — разрешает любые источники (⚠️ несовместимо с `AllowCredentials()`).
- `WithMethods(params string[])` — разрешает только указанные методы (`GET`, `POST` и т.п.).
- `AllowAnyMethod()` — разрешает все методы.
- `WithHeaders(params string[])` — разрешает конкретные заголовки.
- `AllowAnyHeader()` — разрешает все заголовки.
- `ExposeHeaders(params string[])` — позволяет клиенту видеть указанные заголовки ответа.
- `AllowCredentials()` — разрешает отправку cookies, заголовков авторизации и т.д.

---

### Outer links:
> О том как правильно настраивать JS-клиент для работы с CORS можно посмотреть на Metanit по ссылке:
> https://metanit.com/sharp/aspnet6/14.2.php

https://metanit.com/sharp/aspnet6/14.3.php