#Csharp #ASP

# 1.1. Аутентификация в ASP.NET Core

Интерфейс сервисов - `IAuthenticationService`
Регистрация сервисов - `AddAuthentication()`
Middleware - `AuthenticationMiddleware` / `UseAuthentication()`

```csharp
public static AuthenticationBuilder AddAuthentication(this IServiceCollection services)
// + схема аутентификации
public static AuthenticationBuilder AddAuthentication(this IServiceCollection services, string defaultScheme)
// + делегат с опциями
public static AuthenticationBuilder AddAuthentication(this IServiceCollection services, Action<AuthenticationOptions> configureOptions)
```

**Схема аутентификации** - позволяет выбирать определенный обработчик аутентификации. 
**Обработчик аутентификации** - выполняет непосредственную аутентификацию пользователей на основе данных запросов.
> Можно создавать свои схемы и обработчики для них.

**Схемы аутентификации:**
- "*Cookies*": на основе куки. 
	- Хранится в константе `CookieAuthenticationDefaults.AuthenticationScheme`.
	- Обработчик - `Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler`
	- Метод подключения - `AddCookie()`
- "*Bearer*": на основе jwt-токенов. 
	- Хранится в константе `JwtBearerDefaults.AuthenticationScheme`. 
	- Обработчик - `Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler`. 
	- (Нужен пакет - `Microsoft.AspNetCore.Authentication.JwtBearer`)
	- Метод подключения - `AddJwtBearer()`

```csharp
var builder = WebApplication.CreateBuilder(); // добавление сервисов аутентификации
builder.Services.AddAuthentication("Bearer")  // схема аутентификации - с помощью jwt-токенов
    .AddJwtBearer();                          // подключение аутентификации с помощью jwt-токенов
 
var app = builder.Build();
 
app.UseAuthentication();   // добавление middleware аутентификации
```

### Outer links:
https://metanit.com/sharp/aspnet6/13.1.php