#Csharp #ASP

# 6. Авторизация по ролям в ASP.NET Core

Таким образом, мы можем разграничивать доступ в приложении в зависимости от роли пользователя.

Смысл следующий: 
1. Можно создать некоторый класс пользователя с текстовым полем, которое будет представлять название группы прав (роли).
```csharp
class Person
{
    public string Email { get; set; }
    public string Password { get; set; }
    public Role Role { get; set; }
    public Person(string email, string password, Role role)
    {
        Email = email;
        Password = password;
        Role = role;
    }
}
class Role
{
    public string Name { get; set; }
    public Role(string name) => Name = name;
}
```

2. При записи кук, можно указать данное поле как тип `ClaimsIdentity.DefaultRoleClaimType`.
```csharp
var claims = new List<Claim>
{
	new Claim(ClaimsIdentity.DefaultNameClaimType, person.Email),
	new Claim(ClaimsIdentity.DefaultRoleClaimType, person.Role.Name)
};
var claimsIdentity = new ClaimsIdentity(claims, "Cookies");
var claimsPrincipal = new ClaimsPrincipal(claimsIdentity);
await context.SignInAsync(claimsPrincipal);
```

3. После чего можно в аттрибутах аутентификации можно будет указывать через запятую роли, которым предоставляется доступ к ресурсу.
```csharp
app.Map("/", [Authorize(Roles = "admin, user")](HttpContext context) =>
{
    var login = context.User.FindFirst(ClaimsIdentity.DefaultNameClaimType);
    var role = context.User.FindFirst(ClaimsIdentity.DefaultRoleClaimType);  
    return $"Name: {login?.Value}\nRole: {role?.Value}";
});
```

### Outer links:
https://metanit.com/sharp/aspnet6/13.7.php