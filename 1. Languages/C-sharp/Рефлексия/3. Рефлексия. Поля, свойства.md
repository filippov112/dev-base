#lang #lang-c_sharp 

---
### Поля - `FieldInfo`

1. **Получение:**
	- `GetFields()` - возвращает массив объектов класса `FieldInfo`.
	- `GetField()` - получение одного поля. 
	- Можно настраивать флагами:
		```csharp
		BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static
		```
		
		```csharp
		var name = myType.GetField("name", BindingFlags.Instance | BindingFlags.NonPublic);
		```
2. **Функционал поля:**
	- Свойство `IsFamily`: возвращает `true`, если поле имеет модификатор доступа `protected`
	- Свойство `IsFamilyAndAssembly`: возвращает `true`, если поле имеет модификатор доступа `private protected`
	- Свойство `IsFamilyOrAssembly`: возвращает `true`, если поле имеет модификатор доступа `protected internal`
	- Свойство `IsAssembly`: возвращает `true`, если поле имеет модификатор доступа `internal`
	- Свойство `IsPrivate`: возвращает `true`, если поле имеет модификатор доступа `private`
	- Свойство `IsPublic`: возвращает `true`, если поле имеет модификатор доступа `public`
	- Свойство `IsStatic`: возвращает `true`, если поле статическое
	Рефлексия позволяет получать значения полей и изменять их даже у приватных полей.
	- Метод `GetValue()`: возвращает значение поля
	- Метод `SetValue()`: устанавливает значение поля


### Свойства - `PropertyInfo`
1. **Получение:**
	- `GetProperties()` возвращает массив объектов `PropertyInfo`.
	- `GetProperty()` - 1 свойство, передается название, возвращает `PropertyInfo?`.
2. **Функционал свойства:**
	- Свойство `Attributes`: возвращает коллекцию атрибутов свойства
	- Свойство `CanRead`: возвращает true, если свойство доступно для чтения
	- Свойство `CanWrite`: возвращает true, если свойство доступно для записи
	- Свойство `GetMethod`: возвращает get-акссесор в виде объекта `MethodInfo?`
	- Свойство `SetMethod`: возвращает set-акссесор в виде объекта `MethodInfo?`
	- Свойство `PropertyType`: возвращает тип свойства
	- Метод `GetValue()`: возвращает значение свойства
	- Метод `SetValue()`: устанавливает значение свойства

---

### Примеры

**Пример кода: Получение всех полей класса с использованием метода GetFields()**

```csharp
using System.Reflection;

Type myType = typeof(Person);

Console.WriteLine("Поля:");
foreach (FieldInfo field in myType.GetFields(
    BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static))
{
    string modificator = "";

    // получаем модификатор доступа
    if (field.IsPublic)
        modificator += "public ";
    else if (field.IsPrivate)
        modificator += "private ";
    else if (field.IsAssembly)
        modificator += "internal ";
    else if (field.IsFamily)
        modificator += "protected ";
    else if (field.IsFamilyAndAssembly)
        modificator += "private protected ";
    else if (field.IsFamilyOrAssembly)
        modificator += "protected internal ";

    // если поле статическое
    if (field.IsStatic) modificator += "static ";

    Console.WriteLine($"{modificator}{field.FieldType.Name} {field.Name}");
}

class Person
{
    static int minAge = 0;
    string name;
    int age;
    public Person(string name, int age)
    {
        this.name = name;
        this.age = age;
    }
    public void Print() => Console.WriteLine($"{name} - {age}");
}
```

**Флаги доступа для получения всех полей:**

```csharp
BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static
```

**Пример консольного вывода:**

```plaintext
Поля:
private String name
private Int32 age
private static Int32 minAge
```

**Пример кода: Получение и изменение значения приватного поля name**

```csharp
using System.Reflection;

Type myType = typeof(Person);
Person tom = new Person("Tom", 37);

// получаем приватное поле name
var name = myType.GetField("name", BindingFlags.Instance | BindingFlags.NonPublic);

// получаем значение поля name
var value = name?.GetValue(tom);
Console.WriteLine(value);   // Tom

// изменяем значение поля name
name?.SetValue(tom, "Bob");
tom.Print();    // Bob - 37

class Person
{
    static int minAge = 1;
    string name;
    int age;
    public Person(string name, int age)
    {
        this.name = name;
        this.age = age;
    }
    public void Print() => Console.WriteLine($"{name} - {age}");
}
```

**Пример кода: Извлечение свойств класса с использованием метода GetProperties()**

```csharp
using System.Reflection;

Type myType = typeof(Person);
foreach (PropertyInfo prop in myType.GetProperties(
    BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static))
{
    Console.Write($"{prop.PropertyType} {prop.Name} {{");

    // если свойство доступно для чтения
    if (prop.CanRead) Console.Write("get;");
    // если свойство доступно для записи
    if (prop.CanWrite) Console.Write("set;");
    Console.WriteLine("}");
}

class Person
{
    public string Name { get; }
    public int Age { get; set; }
    public Person(string name, int age)
    {
        Name = name;
        Age = age;
    }
    public void Print() => Console.WriteLine($"{Name} - {Age}");
}
```

**Пример вывода для свойств:**

```plaintext
System.String Name {get;}
System.Int32 Age {get;set;}
```

**Пример кода: Получение и изменение значения свойства Age**

```csharp
using System.Reflection;

Type myType = typeof(Person);
Person tom = new Person("Tom", 37);
// получаем свойство Age
var ageProp = myType.GetProperty("Age");
// получаем значение свойства Age у объекта tom
var age = ageProp?.GetValue(tom);
Console.WriteLine(age); // 37
// устанавливаем новое значение для свойства Age объекта tom
ageProp?.SetValue(tom, 22);
tom.Print();    // Tom - 22

class Person
{
    public string Name { get; }
    public int Age { get; set; }
    public Person(string name, int age)
    {
        Name = name;
        Age = age;
    }
    public void Print() => Console.WriteLine($"{Name} - {Age}");
}
```

### Inner links:
[_ Рефлексия. Типы (System.Type)](1.%20Languages/C-sharp/Рефлексия/_%20Рефлексия.%20Типы%20(System.Type).md)

### Outer links:
https://metanit.com/sharp/tutorial/14.6.php