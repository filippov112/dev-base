#Csharp 

# Итераторы в C#

**Итераторы** - функции, выполнение которых разбивается на несколько циклов *итераций*. 
Ими могут быть: **методы, операторы, свойства (с геттерами)**.

Подобно *замыканиям* представляют собой *функции с состоянием*, однако в отличие от последних, итераторы запоминают не просто *состояние окружения функции-обертки*, а целиком *статус предыдущего выполнения с внутренним окружением функции*, чтобы при следующем вызове продолжить работу с данного этапа.

- `yield return` - завершение текущей итерации с возвращаением некоторого значения.
- `yield break` - преждевременное завершение итератора.

Создается итератор 2-мя способами:
1. **Классом:** Через реализацию `IEnumerator<T> GetEnumerator()`.
2. **Методом:** Через любой метод, возращающий `IEnumerable<T>` (именованный итератор).

> В Unity существуют *корутины* - как расширенный вариант итераторов. 

**Классом:**

```csharp
foreach(var n in 5) Console.WriteLine(n);
 
static class Int32Extension
{
    public static IEnumerator<int> GetEnumerator(this int number) // пример метода расширения для int, превращающий все экзепмпляры типа в итераторы.
    {
        int k = (number > 0)? number: 0;
        for (int i = number - k; i <= k; i++) yield return i;
    }
}
```

**Методом:**

```csharp
class Person
{
    public string Name { get; }
    public Person(string name) =>Name = name;
}
class Company
{
    Person[] personnel;
    public Company(Person[] personnel) => this.personnel = personnel;
    public int Length => personnel.Length;
    
    public IEnumerable<Person> GetPersonnel(int max) // пример именованного итератора
    {
        for (int i = 0; i < max; i++)
        {
            if (i == personnel.Length)
            {
                yield break;
            }
            else
            {
                yield return personnel[i];
            }
        }
    }
}
```

```csharp
var people = new Person[]
{
    new Person("Tom"), 
    new Person("Bob"),
    new Person("Sam")
};
var microsoft = new Company(people);
 
foreach(Person employee in microsoft.GetPersonnel(5))
{
    Console.WriteLine(employee.Name);
}
```

### Inner links:
[Замыкания](1.%20Languages/C-sharp/0.%20Введение/2.%20Функции/Замыкания.md)
[IEnumerable, IEnumerator](1.%20Languages/C-sharp/0.%20Введение/3.%20Интерфейсы/IEnumerable,%20IEnumerator.md)
[Корутины](1.%20Languages/UNITY/4.%20ВРЕМЯ%20И%20АССИНХРОННОСТЬ/Корутины.md)

### Outer links:
https://metanit.com/sharp/tutorial/4.12.php



