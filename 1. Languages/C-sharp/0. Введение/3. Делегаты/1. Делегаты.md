#Csharp 

# Делегаты в C#

> Делегат - это *тип данных*, который **хранит ссылку на метод** с определенным <u>набором параметров</u> и <u>типом возвращаемого значения</u>.
> ##### Где и зачем используются делегаты?
> - **Обработчики событий** 
> - **Обратные вызовы** 
> - **Асинхронное программирование** 

```csharp
delegate <тип возвращаемого значения> <имя делегата>(список параметров);
```

### О делегатах:

1. Сигнатура функции должна полностью соответствовать делегату, в том числе во внимание также принимаются модификаторы **ref, in и out**.
2. Могут хранить сразу несколько функций (в том числе несколько вызовов одной и той же).
3. Функции в очереди вызываются в том же порядке как были добавлены.
4. Если к делегату не привязано функций, то он равен **null**.
5. Если к делегату привязано несколько функций с результатом, то ==возвращается результат только последней функции в очереди==.
6. При удалении какой-либо функции - ==удаляется только ближайший с конца очереди её вызов==.
7. Представляют собой **очередь** **(список вызова, invocation list)**. И при добавлении/удалении очередной ссылки очередь пересоздается заново.
8. Можно создавать обобщенные делегаты. [1. Generic Типы](1.%20Languages/C-sharp/0.%20Введение/2.%20Универсальные%20типы/1.%20Generic%20Типы.md)
9. Как любой тип данных - можно использовать как параметры методов или как возвращаемый результат.

### Как работать с делегатами?

```csharp
// Определение делегата
delegate void MyDelegate();
delegate void MyDelegateWithParam(int value);
delegate bool MyDelegateWithParamsAndReturn(int value1, string value2);

// Создание экземпляра
MyDelegate d = MyMethod;
MyDelegate d = new MyDelegate(MyMethod);
MyDelegateWithParamsAndReturn md = F;

// Вызов
d();
d.Invoke();
bool result = md(1, 2);

// Добавление методов
d += HowAreYou;

// Удаление методов (первый с конца очереди)
d -= HowAreYou;

// Объединение нескольких делегатов
d = d + d2

// Обобщенные (универсальные) делегаты
delegate T Operation<T, K>(K val);
decimal Square(int n) => n * n;
Operation<decimal, int> squareOperation = Square;
decimal result1 = squareOperation(5);

// Возвращаемый тип
delegate int Operation(int x, int y);
Operation SelectOperation() // Например, если нужно выбирать из нескольких функций обработчиков
{
    return Add;
}
int Add(int x, int y) => x + y;
Operation o = SelectOperation();
Console.WriteLine(operation(10, 4));    // 14
```

### Внутренние ссылки:
[2. Сигнатура](1.%20Languages/C-sharp/0.%20Введение/2.%20Классовые%20механизмы/Перегрузки/2.%20Сигнатура.md)

