#lang #lang-c_sharp 

---
**Ковариантность** делегата предполагает, что *возвращаемым типом* может быть *производный тип*. 
**Контрвариантность** делегата предполагает, что *типом параметра* может быть *базовый тип*.

```csharp
class Message
{
    ...
}
class EmailMessage: Message
{
    ...
}
class SmsMessage : Message
{
    ...
}
```

```csharp
// Ковариантность
// делегату с базовым выходным типом передаем метод с производным
MDelegate mb = WriteEmailMessage; // <== 

Message result = mb("Hello"); // Как я понимаю, ничего кроме неявного преобразования результата тут нет.

EmailMessage WriteEmailMessage(string text) => new EmailMessage(text);
delegate Message MDelegate(string text);
```

```csharp
// Контрвариантность
// делегату с производным входным типом передаем метод с базовым
EMDelegate emd = ReceiveMessage; // <==

emd(new EmailMessage("Welcome"));  // Опять же поскольку в параметры вызова мы всё равно подставляем конкретный тип, то всё сходится к неявному преобразованию, только не на выходе за пределами метода, а на входе внутри самого метода.
 
void ReceiveMessage(Message message) => message.Print();
delegate void EMDelegate(EmailMessage message);
```

### В обобщенных делегатах
Ковариантность и контрвариантность проявляется в использовании модификаторов `out`(ко-) и `in`(контр-).

```csharp
// Ковариантность
// делегату с базовым выходным типом передаем делегат с производным
Delegate<EmailMessage> emailD;
emailD += EmailMethod;
Delegate<Message> messageD;

messageD += emailD; // <==

Message s = messageD("hello Tom"); // Опять таки неявное преобразование EmailMessage => Message на выходе.

EmailMessage EmailMethod(string text) => new EmailMessage(text);
delegate T Delegate<out T>(string text);
```

```csharp
// Контрвариантность
// делегату с производным входным типом передаем делегат с базовым
MDelegate<Message> messageD;
messageD += MessageMethod;
MDelegate<EmailMessage> emailD;

emailD += messageD; // <==

emailD(new EmailMessage("Hello World!"));  // Опять таки на входе имеем неявное преобразование EmailMessage => Message.

void MessageMethod(Message s) => s.Print();
delegate void MDelegate<in T>(T message);
```

### Inner links:
[1. Делегаты](1.%20Languages/C-sharp/0.%20Введение/3.%20Делегаты/1.%20Делегаты.md)