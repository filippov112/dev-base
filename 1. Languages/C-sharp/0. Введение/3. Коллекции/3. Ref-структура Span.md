#Csharp #Collections

# Ref-структура Span в C#

**`Span<T>`** - *ref-структура*, коллекция схожая с обычным **массивом**.
Цель данного типа - повысить производительность и эффективность использования памяти.
Кроме того существует варинат **`ReadOnlySpan<T>`**, защищенный от изменений.

> Можно его использовать, если требуется доступ к элементам некоторой коллекции, не предоставляя доступа к самой коллекции, а только к данным хранящимся в ней.
> Т.е. по сути **Span** - набор переменных ссылок на элементы других коллекций.

**Конструкторы:**
- `[T a, T b, T c, ...]` - выражение.
- Неявное преобразование из массива.
- `Span()` - создает пустой объект `Span`
- `Span(T item)` - создает объект `Span` с одним элементом `item`
- `Span(T[] array)` - создает объект `Span` из массива `array`
- `Span(void* pointer, int length)` - создает объект `Span`, который получает `length` байт памяти, начиная с указателя `pointer`
- `Span(T[] array, int start, int length)` - создает объект `Span`, который получает из массива `array` `length` элементов, начиная с индекса `start`

**Ограничения:**
- Не может быть присвоена переменной типа `Object`, `dynamic` или переменной типа *интерфейса*.
- Не может быть полем в *объекте ссылочного типа* (а только внутри *ref-структур*).
- Не может использоваться в пределах операций `await` или `yield`.

**Методы:**
- `void Fill(T value)` - заполняет все элементы Span значением value
- `T[] ToArray()` - преобразует Span в массив
- `Span<T> Slice(int start, int length)` - выделяет из Span length элементов начиная с индекса start в виде другого Span
- `void Clear()` - очищает Span
- `void CopyTo(Span<T> destination)` - копирует элементы текущего Span в другой Span
- `bool TryCopyTo(Span<T> destination)` - копирует элементы текущего Span в другой Span, но при этом также возвращает значение bool, которое указывает, удачно ли прошла операция копирования


```csharp
string[] people = { "Tom", "Alice", "Bob" };
Span<string> peopleSpan = people;
peopleSpan[1] = "Ann";              // переустановка значения элемента
Console.WriteLine(peopleSpan[2]);   // получение элемента
Console.WriteLine(peopleSpan.Length);   // получение длины Span
 
// перебор Span
foreach (var s in peopleSpan)
{
    Console.WriteLine(s);
}
```


### Inner links:
[1. Коллекции](1.%20Languages/C-sharp/0.%20Введение/3.%20Коллекции/1.%20Коллекции.md)
[Переменные ссылки](1.%20Languages/C-sharp/0.%20Введение/1.%20Типы%20данных/Переменные%20ссылки.md)
[1. Структуры](1.%20Languages/C-sharp/0.%20Введение/2.%20Классы%20и%20структуры/1.%20Структуры.md)

### Outer links:


