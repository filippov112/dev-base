#lang #lang-c_sharp 

# LINQ, Проекция данных в C#

Проекция позволяет преобразовать объект одного типа в объект другого типа.
В LINQ под проекцией понимаются <u>способы выборки</u> нужных данных из записей. 
Осуществляется операторами/методами `Select`, `SelectMany`.
- `let` - позволяет использовать временные переменные
- Можно забирать сразу из нескольких источников параллельно (аналог `zip` функции в `Python`, но неограниченный)

### **Методы:**
```csharp
Select(Func<TSource,TResult> selector)

SelectMany(Func<TSource, IEnumerable<TResult>> selector);

SelectMany(Func<TSource, IEnumerable<TCollection>> collectionSelector, Func<TSource,TCollection,TResult> resultSelector);
```

- `Func<TSource,TResult> selector` - ф-ция получения 1 объекта типа `TResult`  из каждой записи `TSource`.
- `Func<TSource, IEnumerable<TCollection>> collectionSelector` - ф-ция получения 1 объекта коллекции из каждой записи `TSource`. Элементы всех коллекций затем собираются в одну результирующую.
- `Func<TSource,TCollection,TResult> resultSelector` - ф-ция преобразования каждого объекта результирующей коллекции `TCollection` на основе исходной записи `TSource` в объект типа `TResult`.

---
### Примеры 

##### **Операторы:**
```csharp
var names = from p in people 
	select p.Name;
```

```csharp
var personel = from p in people 
	select new // анонимные типы
	{
		FirstName = p.Name,
		Year = DateTime.Now.Year - p.Age
	};
```

```csharp
var personnel = from p in people
   let name = $"Mr. {p.Name}"
   let year = DateTime.Now.Year - p.Age
   select new
	{
		Name = name,
		Year = year
	};
```

```csharp
var enrollments = from course in courses
	 from student in students      
	 select new { Student = student.Name, Course = course.Title};   // соединяем попарно
```

```csharp
//var companies = new List<Company>
//{
//    new Company("Microsoft", new List<Person> {new Person("Tom"), new Person("Bob")}),
//    new Company("Google", new List<Person> {new Person("Sam"), new Person("Mike")}),
//};

var employees = from c in companies
	from emp in c.Staff
	select emp;
                
var employees = from c in companies
	from emp in c.Staff
	select new { Name = emp.Name, Company = c.Name };
```

##### **Методы расширения:**
```csharp
var names = people.Select(u => u.Name);
```

```csharp
var personel = people.Select(p => new
{ 
    FirstName = p.Name, 
    Year = DateTime.Now.Year - p.Age 
});
```

```csharp
//var companies = new List<Company>
//{
//    new Company("Microsoft", new List<Person> {new Person("Tom"), new Person("Bob")}),
//    new Company("Google", new List<Person> {new Person("Sam"), new Person("Mike")}),
//}; 

var employees = companies.SelectMany(
	c => c.Staff
); // tom, bob, sam, mike

var employees = companies.SelectMany(
	c => c.Staff, 
	(c, emp) => new { Name = emp.Name, Company = c.Name }
);
```

### Inner links:
[_ LINQ](1.%20Languages/C-sharp/Базы%20данных/LINQ/_%20LINQ.md)
### Outer links:
https://metanit.com/sharp/tutorial/13.6.php