#lang #lang-c_sharp 

---
В параллельных запросах PLINQ порядок данных в результирующей выборке может быть *неупорядоченным*.
**Сортировка с `orderby` или `OrderBy`**: При использовании операторов сортировки данные автоматически упорядочиваются, но это выполняется по результирующим значениям, а *не по исходной последовательности*.

- **Метод `AsOrdered()`** - позволяет упорядочить результат параллельного запроса в соответствии с исходным порядком элементов, но может снизить производительность из-за дополнительных затрат.
- **Метод `AsUnordered()`** - отключает упорядочивание для последующих операций, что помогает оптимизировать производительность.

---

### Примеры кода:

1. **Пример с неупорядоченным выводом при параллельной обработке** — квадраты чисел больше 0 выводятся в случайном порядке:
    ```csharp
    int[] numbers = new int[] { -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8 };
    var squares = from n in numbers.AsParallel()
                     where n > 0
                     select Square(n);

    foreach (var n in squares)
        Console.WriteLine(n);

    int Square(int n) => n * n;
    ```
   *Результат*:
   ```
   1
   16
   49
   4
   25
   64
   9
   36
   ```
   *Ссылка на положения*: [1]

2. **Пример с сортировкой через `orderby` в параллельной обработке** — упорядочивание по значениям:
    ```csharp
    var squares = from n in numbers.AsParallel()
                     where n > 0
                     orderby n
                     select Square(n);
    ```
   *Ссылка на положения*: [2]

3. **Пример с `AsOrdered` для сохранения исходного порядка в параллельной обработке** — результат сохраняет исходный порядок данных:
    ```csharp
    var squares = from n in numbers.AsParallel().AsOrdered()
                     where n > 0
                     select Square(n);
    ```
   *Ссылка на положения*: [3]

4. **Пример с `AsUnordered` для отмены упорядочивания на следующих шагах обработки** — результат неупорядочен, что снижает издержки:
    ```csharp
    int[] numbers = new int[] { -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8 };
    var squares = from n in numbers.AsParallel().AsOrdered()
                     where n > 0
                     select Square(n);

    var query = from n in squares.AsUnordered()
                where n > 4
                select n;

    foreach (var n in query)
        Console.WriteLine(n);

    int Square(int n) => n * n;
    ```
   *Ссылка на положения*: [4]

### Inner links:
[_ LINQ](1.%20Languages/C-sharp/Базы%20данных/LINQ/_%20LINQ.md)

### Outer links:
https://metanit.com/sharp/tutorial/17.2.php