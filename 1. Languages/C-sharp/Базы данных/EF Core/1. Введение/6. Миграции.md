№600 #Csharp #EntityFramework

# 8. Миграции в Entity Framework

`XXXXXXXXXXXXXX_InitialCreate.cs` - **основной файл миграции**, который содержит все применяемые действия
`[Имя_контекста_данных]ModelSnapshot.cs` - содержит текущее состояние модели, используется при создании следующей миграции

Примечания:
- Все миграции попадают в каталог `Migrations`
- БД не должна существовать на момент первой миграции.
- Если конструктор контекста БД принимает параметр `DbContextOptions`, то для миграций требуется реализация [IDesignTimeDbContextFactory](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/_/IDesignTimeDbContextFactory.md)

Дополнительно:
- [Бандлы миграций](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/_/Бандлы%20миграций.md)
- [EnsureCreated](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/_/EnsureCreated,%20EnsureDeleted,%20CanConnect.md) - должен быть убран
- [Database.Migrate](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/_/Database.Migrate.md)
- [Генерация скриптов миграций](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/_/Генерация%20скриптов%20миграций.md)
---
### <font color="#ffff00">Инструкция</font>

1. <font color="#e36c09">Добавляем инструменты для EF Core</font>
	```bash
	dotnet tool install --global dotnet-ef
	```
2. <font color="#e36c09">Ставим пакет `Microsoft.EntityFrameworkCore.Tools`</font>
	```bash
	dotnet add package Microsoft.EntityFrameworkCore.Tools
	```
3. <font color="#e36c09">Создадим миграции (любое уникальное название):</font>
	```bash
	// CLI
	dotnet ef migrations add название_миграции
	
	// PMC
	Add-Migration название_миграции
	```
4. <font color="#e36c09">Применим:</font>
	```bash
	// CLI
	dotnet ef database update
	
	// PMC
	Update-Database
	```

### Outer links:
https://metanit.com/sharp/efcore/2.2.php