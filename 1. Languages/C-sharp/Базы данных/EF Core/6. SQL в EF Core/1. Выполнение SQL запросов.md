#EntityFramework #Csharp 
# <font color="#00b0f0">EF Core:</font> Выполнение SQL запросов

---
#### **SQL-запросы `FromSqlRaw`**  
Возвращает набор объектов, соответствующих модели.  
Запрос не должен извлекать связанные данные.  
Структура результата должна соответствовать модели.  
 
```csharp
var comps = db.Companies.FromSqlRaw("SELECT * FROM Companies").ToList();

var comps = db.Companies.FromSqlRaw("SELECT * FROM Companies").OrderBy(x => x.Name).ToList();

var users = db.Users.FromSqlRaw("SELECT * FROM Users").Include(c => c.Company).ToList();
```  

---
#### **SQL-команды `ExecuteSqlRaw`** 
Возвращает количество затронутых строк.  
Асинхронная версия: `ExecuteSqlRawAsync`.  

```csharp
// Вставка
int inserted = db.Database.ExecuteSqlRaw("INSERT INTO Companies (Name) VALUES ({0})", "Apple");

// Обновление
int updated = db.Database.ExecuteSqlRaw("UPDATE Companies SET Name={0} WHERE Name={1}", "Apple Inc.", "Apple");

// Удаление
int deleted = db.Database.ExecuteSqlRaw("DELETE FROM Companies WHERE Name={0}", "Apple Inc.");
```  

---
#### **Параметры**  

1. **Нумерованные параметры:**
	```csharp
	var name = "%Tom%";
	var users = db.Users.FromSqlRaw("SELECT * FROM Users WHERE Name LIKE {0}", name).ToList();
	```

2. **Именованные параметры:**
	- Для разных СУБД используются разные классы параметров (`SqliteParameter`, `SqlParameter`).
		- SQLite: `SqliteParameter` (пространство имен `Microsoft.Data.Sqlite`).  
		- MS SQL Server: `SqlParameter` (пространство имен `Microsoft.Data.SqlClient`).  
	```csharp
	SqliteParameter param = new SqliteParameter("@name", "%Tom%");
	var users = db.Users.FromSqlRaw("SELECT * FROM Users WHERE Name LIKE @name", param).ToList();
	```  
  
3. **Интерполяция строк:**  
	- `FromSqlInterpolated` (для выборки).  
	- `ExecuteSqlInterpolated` (для изменения данных).  
	- `ExecuteSqlInterpolatedAsync` (асинхронная версия).  

	```csharp
	var name = "%Tom%";
	var age = 30;
	var users = db.Users.FromSqlInterpolated($"SELECT * FROM Users WHERE Name LIKE {name} AND Age > {age}").ToList();
	```  
	
	```csharp
	string jetbrains = "JetBrains";
	db.Database.ExecuteSqlInterpolated($"INSERT INTO Companies (Name) VALUES ({jetbrains})");
	```  

---
### Outer links:
https://metanit.com/sharp/efcore/6.1.php