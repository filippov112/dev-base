#EntityFramework #Csharp 
# <font color="#00b0f0">EF Core:</font> Конфигурации связей

Связи между сущностями определяются с помощью:  **Внешних ключей** и **Навигационных свойств**. 
При добавлении данных можно использовать любой из доступных вариантов.

```csharp
public int CompanyId { get; set; }      // внешний ключ
public Company? Company { get; set; }    // навигационное свойство
```

- **Каскадное удаление** включается по умолчанию, если связь **обязательная** (`public Company Company` вместо `Company? Company`).  
- Отсутствие навигационного свойства и ключа в **зависимой** сущности **не исключает связь**, если она определена в **главной** сущности.  
- Рекомендуется явно указывать внешний ключ для контроля имени столбца и оптимизации запросов.  

---
#### **Правила именования:**
EF Core автоматически определяет внешний ключ, если его имя соответствует одному из шаблонов:  
1. **`Имя_навигационного_свойства + Имя_ключа`** 
2. **`Имя_класса_главной_сущности + Имя_ключа`**

---
#### **Способы установки связи**  
1. **Через навигационное свойство зависимой сущности**:  
   ```csharp
   User user = new User { Name = "Tom", Company = company };
   ```  
2. **Через внешний ключ зависимой сущности**:  
   - Требует предварительного сохранения главной сущности (`Company`) для получения `Id`.  
   ```csharp
   User user = new User { Name = "Tom", CompanyId = company.Id };
   ```  
3. **Через навигационное свойство главной сущности**:  
   ```csharp
   Company company = new Company { Name = "Google", Users = { user1, user2 } };
   ```  

---
#### **Автоматическое создание внешнего ключа**  
Если внешний ключ не указан явно, EF Core создаст его автоматически:  
  ```csharp
  public class User
  {
      public int Id { get; set; }
      public Company? Company { get; set; }  // EF Core добавит столбец "CompanyId"
  }
  ```   

---
### Outer links:
https://metanit.com/sharp/efcore/3.1.php