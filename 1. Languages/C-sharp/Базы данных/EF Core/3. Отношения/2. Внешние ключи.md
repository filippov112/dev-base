#EntityFramework #Csharp 
# <font color="#00b0f0">EF Core:</font> Внешние ключи

---
### **Через аннотации**  
- **Атрибут `[ForeignKey]`** - позволяет явно указать свойство, которое будет внешним ключом, даже если оно не соответствует соглашениям EF Core.  
  ```csharp
  public class User
  {
      public int Id { get; set; }
      public string? Name { get; set; }
      public int? CompanyInfoKey { get; set; }  // Внешний ключ
      [ForeignKey("CompanyInfoKey")]
      public Company? Company { get; set; }     // Навигационное свойство
  }
  ```

---
### **Через Fluent API**  
- `HasOne()` / `HasMany()` – определяют навигационное свойство для текущей сущности.  
- `WithOne()` / `WithMany()` – определяют навигационное свойство для связанной сущности.  
- `HasForeignKey()` – указывает свойство-внешний ключ.  
	```csharp
	protected override void OnModelCreating(ModelBuilder modelBuilder)
	{
		modelBuilder.Entity<User>()
		  .HasOne(u => u.Company)       // У User есть Company
		  .WithMany(c => c.Users)       // У Company много Users
		  .HasForeignKey(u => u.CompanyInfoKey);  // Внешний ключ
	}
	```

##### **Связь с произвольным свойством (не с первичным ключом)**  
- **Метод `HasPrincipalKey()`** позволяет связать внешний ключ с любым свойством связанной сущности (не только с `Id`).  
  ```csharp
  modelBuilder.Entity<User>()
      .HasOne(u => u.Company)
      .WithMany(c => c.Users)
      .HasForeignKey(u => u.CompanyName)    // Внешний ключ в User
      .HasPrincipalKey(c => c.Name);       // Ссылается на Company.Name
  ```
---
[7. Один к одному](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/3.%20Отношения/7.%20Один%20к%20одному.md)
[8. Один ко многим](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/3.%20Отношения/8.%20Один%20ко%20многим.md)
[9. Многие ко многим](1.%20Languages/C-sharp/Базы%20данных/EF%20Core/3.%20Отношения/9.%20Многие%20ко%20многим.md)

---
### Outer links:
https://metanit.com/sharp/efcore/3.10.php