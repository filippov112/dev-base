#lang #lang-c_sharp
# <font color="#00b0f0">C#:</font> Получение зависимостей
 
Способы получения зависимостей:  
1. **Напрямую из коллекции `ServiceCollection`** (редко используется).  
2. **Через `IServiceProvider` (Service Locator)** – методы `GetService()` и `GetRequiredService()`.  
3. **Через конструктор класса** (предпочтительный способ).  

| Способ                     | Плюсы                          | Минусы                          |  
|----------------------------|--------------------------------|---------------------------------|  
| **Service Locator** (`GetService`) | Простота в простых случаях     | Плохая масштабируемость, сложное тестирование |  
| **Внедрение через конструктор** | Чистый код, легко тестировать | Требует регистрации всех зависимостей |  

---
#### **Через `IServiceProvider`**  

- **`GetService<T>()`** – возвращает сервис или `null`, если он не зарегистрирован.  
- **`GetRequiredService<T>()`** – возвращает сервис или выбрасывает исключение, если он не зарегистрирован.  
 
```csharp
//var services = new ServiceCollection().AddTransient<ITimeService, ShortTimeService>();  
//using var serviceProvider = services.BuildServiceProvider();  

// Способ 1: GetService (возвращает null, если сервиса нет)  
var timeService1 = serviceProvider.GetService<ITimeService>();  

// Способ 2: GetRequiredService (выбрасывает исключение, если сервиса нет)  
var timeService2 = serviceProvider.GetRequiredService<ITimeService>();  
```  

**Проблемы:**  
- Прямая зависимость от контейнера.  
- Усложняет тестирование.  
- Скрывает зависимости (их сложно отследить).  

---
#### **Через конструктор (рекомендуемый способ)**  

```csharp
class TimeMessage  
{  
    private readonly ITimeService _timeService;  

    public TimeMessage(ITimeService timeService)  // Контейнер видит, что `TimeMessage` требует `ITimeService`.  
    {  
        _timeService = timeService;  
    }  
}  
```  

**Регистрация и использование:**  
```csharp
var services = new ServiceCollection()  
    .AddTransient<ITimeService, ShortTimeService>()  // Проверяет, что `ITimeService` зарегистрирован как `ShortTimeService`.
    .AddTransient<TimeMessage>();  // Создает `ShortTimeService` и передает его в конструктор `TimeMessage`.  

using var serviceProvider = services.BuildServiceProvider();  

var timeMessage = serviceProvider.GetRequiredService<TimeMessage>();  
```  

---
### Outer links:
- https://metanit.com/sharp/dotnet/1.2.php