#lang #lang-c_sharp
# <font color="#00b0f0">C#:</font> Основы валидации модели


**Валидация модели** – проверка данных на соответствие заданным правилам.  

Когда полезна?
- Большой объём кода с условными проверками.  
- Сложность поддержки при добавлении новых свойств.  

---
#### **Атрибуты валидации**   
пространство имён `System.ComponentModel.DataAnnotations`. 

```csharp
public class User  
{  
    [Required] // Поле обязательно для заполнения.
    [StringLength(50, MinimumLength = 3)]  // Ограничивает длину строки.
    public string Name { get; set; }  

    [Range(1, 100)]  // Задаёт допустимый диапазон значений. 
    public int Age { get; set; }  
	//...
}  
```  

**Для `record`-типов:**  
```csharp
public record User(  
    [property: Required]  
    [property: StringLength(50, MinimumLength = 3)]  
    string Name,  
    [property: Range(1, 100)] int Age  
);  
```  

---

#### **Проверка валидации**  

- `Validator.TryValidateObject()` – проверяет объект на соответствие атрибутам.  
	- `ValidationContext` – контекст валидации для объекта.
	- `List<ValidationResult>` - список ошибок (свойства: `MemberNames` - список проблемных свойств, `ErrorMessage` - сообщение об ошибке.)
	- `true` - надо ли валидировать все свойства.
```csharp
void CreateUser(string name, int age)  
{  
    User user = new User(name, age);  
    var context = new ValidationContext(user);  
    var results = new List<ValidationResult>();  

    if (!Validator.TryValidateObject(user, context, results, true))  
    {  
        Console.WriteLine("Ошибка валидации:");  
        foreach (var error in results)  
            Console.WriteLine(error.ErrorMessage);  
    }  
    else  
        Console.WriteLine($"Успешно создан: {user.Name}");  
}  
```  

---
### Outer links:
- https://metanit.com/sharp/dotnet/2.1.php