#lang #lang-c_sharp  
# <font color="#00b0f0">ASP.NET:</font> –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ MemoryCache

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∏ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É.

**üìå –ö–æ–≥–¥–∞ –Ω–∞–¥–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å?**
üîπ –î–∞–Ω–Ω—ã–µ —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è, –Ω–æ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è.  
üîπ –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ API –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏ –Ω–∞–≥—Ä—É–∂–∞—é—Ç —Å–µ—Ä–≤–µ—Ä.  
üîπ –î–∞–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –¥–æ–ª–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–∂–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã).

**üìå –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–µ–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.  
‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ API.  
‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞.  
‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞.

**üìå –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
üîπ **Pre-caching (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)** ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫—ç—à –∑–∞—Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).
üîπ **On-demand caching (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)** ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫—ç—à –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ, –µ—Å–ª–∏ –∏—Ö —Ç–∞–º –Ω–µ—Ç.

---

## üìå <font color="#ffff00">**MemoryCache** –≤ ASP.NET Core</font>

**MemoryCache** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞).

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º `IMemoryCache`:

üîπ `TryGetValue(key, out value)` ‚Äî –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞.  
üîπ `GetOrCreate(key, factory)` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫—ç—à–∞ –∏–ª–∏ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–µ.  
üîπ `Get(key)` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.  
üîπ `Set(key, value, options)` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.  
üîπ `Remove(key)` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `Program.cs`:
```csharp
builder.Services.AddMemoryCache();
```

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ `IMemoryCache` –≤ —Å–µ—Ä–≤–∏—Å –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:

```csharp
public class WeatherService
{
    private readonly IMemoryCache _cache;

    public WeatherService(IMemoryCache cache)
    {
        _cache = cache;
    }

    public string GetWeather()
    {
        string cacheKey = "weather";
        if (!_cache.TryGetValue(cacheKey, out string weather))
        {
            weather = "–°–æ–ª–Ω–µ—á–Ω–æ"; // –ó–¥–µ—Å—å –º–æ–≥ –±—ã –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API
            _cache.Set(cacheKey, weather, TimeSpan.FromMinutes(5));
        }
        return weather;
    }
}
```

#### üìå **MemoryCacheEntryOptions**
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**–°–≤–æ–π—Å—Ç–≤–∞:**
- `AbsoluteExpiration` ‚Äî –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ —ç–ª–µ–º–µ–Ω—Ç –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω.
- `SlidingExpiration` ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–æ—Å—Ç—É–ø–µ.
- `Size` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø–∏—Å–∏.
- `Priority` ‚Äî –≤–∞–∂–Ω–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–∞ (`Low`, `Normal`, `High`, `NeverRemove`).
- `PostEvictionCallbacks` ‚Äî –∫–æ–ª–ª–±–µ–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ –∫—ç—à–∞. - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞, –∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

üìå **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `MemoryCacheEntryOptions`**
```csharp
var cacheOptions = new MemoryCacheEntryOptions()
{
    AbsoluteExpirationRelativeToNow = TimeSpan.FromMinutes(10),
    SlidingExpiration = TimeSpan.FromMinutes(2),
    Priority = CacheItemPriority.High
};

_cache.Set("userProfile", userData, cacheOptions);
```

---
### Outer links:
https://metanit.com/sharp/aspnet6/17.1.php