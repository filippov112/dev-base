#lang #lang-c_sharp 

# 5. Results. Файлы в ASP.NET Core

Для отправки используется метод `File()` в нескольких вариантах:

### 1. Как массив байтов

```csharp
public static IResult File (byte[] fileContents, string? contentType = default, 
string? fileDownloadName = default, bool enableRangeProcessing = false, 
DateTimeOffset? lastModified = default, Microsoft.Net.Http.Headers.EntityTagHeaderValue? entityTag = default);
```

- `fileContents`: содержимое файла в виде массива байтов
- `contentType`: тип содержимого файла - заголовок `Content-Type`
- `fileDownloadName`: имя файла для загрузки
- `enableRangeProcessing`: значение типа bool. Если оно равно `true`, то допустима обработка данных по частям
- `lastModified`: значение типа `Nullable<DateTimeOffset>>`, которое указывает на дату последнего изменения файла
- `entityTag`: значение типа `EntityTagHeaderValue`, которое ассоциировано с файлом


```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.Map("/forest", async () => 
{
    string path = "Files/forest.png";
    byte[] fileContent = await File.ReadAllBytesAsync(path);  // считываем файл в массив байтов
    string contentType = "image/png";       // установка mime-типа
    string downloadName = "winter_forest.png";  // установка загружаемого имени
    return Results.File(fileContent, contentType, downloadName);
});
 
app.Map("/", () => "Hello World");
 
app.Run();
```

---
### 2. Как файловый поток

```csharp
public static IResult File (System.IO.Stream fileStream, string? contentType = default, 
string? fileDownloadName = default, DateTimeOffset? lastModified = default, 
Microsoft.Net.Http.Headers.EntityTagHeaderValue? entityTag = default, bool enableRangeProcessing = false);
```

```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.Map("/forest", () => 
{
    string path = "Files/forest.png";
    FileStream fileStream = new FileStream(path, FileMode.Open);
    string contentType = "image/png";
    string downloadName = "winter_forest.png";
    return Results.File(fileStream, contentType, downloadName);
});
 
app.Map("/", () => "Hello World");
 
app.Run();
```

---
### 3. Отправка файла по пути
Данная версия метода вычисляет пути к файлам относительно папки, которая задается параметром `WebRootPath` - по умолчанию это папка `wwwroot`.
```csharp
public static IResult File (string path, string? contentType = default, 
string? fileDownloadName = default, DateTimeOffset? lastModified = default, 
Microsoft.Net.Http.Headers.EntityTagHeaderValue? entityTag = default, bool enableRangeProcessing = false);
```

```csharp
var builder = WebApplication.CreateBuilder(
    new WebApplicationOptions { WebRootPath = "Files" });  // добавляем папку для хранения файлов
var app = builder.Build();
 
app.Map("/river", () => 
{
    string path = "newRiver.jpg";
    string contentType = "image/jpeg";
    string downloadName = "river.jpg";
    return Results.File(path, contentType, downloadName);
});
 
app.Map("/", () => "Hello World");
 
app.Run();
```


### Outer links:
https://metanit.com/sharp/aspnet6/10.5.php