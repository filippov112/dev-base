#lang #lang-c_sharp 

---
**Типы сервисов по жизненному циклу:**

- `Transient`: при каждом *обращении* к сервису (конкретному типу зависимости, независимо от места вызова) создается новый объект сервиса. 
<br>
- `Scoped`: для каждого *http-запроса* создается свой объект сервиса. 
	**Нужно учитывать:** scoped-сервисы не могут внедряться в конструкторы middleware-ов, или синглтон-сервисов (даже во вложенном виде - т.е. когда scoped-сервис является зависимостью - зависимости - зависимости и т.д.) 
<br>
- `Singleton`: объект сервиса создается при *первом обращении* к нему, все последующие запросы используют один и тот же ранее созданный объект сервиса

Для создания каждого типа сервиса предназначен соответствующий метод `AddTransient()`, `AddScoped()` и `AddSingleton()`.

---

**Список перегрузок методов:**
- `AddTransient(Type serviceType)`
- `AddTransient(Type serviceType, Type implementationType)`
- `AddTransient(Type serviceType, Func<IServiceProvider,object> implementationFactory)`
- `AddTransient<TService>()`
- `AddTransient<TService, TImplementation>()`
- `AddTransient<TService>(Func<IServiceProvider,TService> implementationFactory)`
- `AddTransient<TService, TImplementation>(Func<IServiceProvider,TImplementation> implementationFactory)`

---
Можно создавать сингтоны вручную, передавая их провайдеру для подключения:
```csharp
var builder = WebApplication.CreateBuilder();
 
RandomCounter rndCounter = new RandomCounter();
builder.Services.AddSingleton<ICounter>(rndCounter);
builder.Services.AddSingleton<CounterService>(new CounterService(rndCounter));
 
var app = builder.Build();
 
app.UseMiddleware<CounterMiddleware>();
 
app.Run();
```

### Outer links:
https://metanit.com/sharp/aspnet6/4.4.php

https://metanit.com/sharp/aspnet6/4.6.php