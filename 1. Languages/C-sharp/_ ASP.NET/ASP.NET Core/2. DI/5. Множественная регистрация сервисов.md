#lang #lang-c_sharp 

---
1. При регистрации **нескольких реализаций** на **одну зависимость** - зависимость превращается в `IEnumerable<зависимость>`.
	```csharp
	builder.Services.AddTransient<IHelloService, RuHelloService>();
	builder.Services.AddTransient<IHelloService, EnHelloService>();
	...
	class HelloMiddleware
	{
	    readonly IEnumerable<IHelloService> helloServices;
	 
	    public HelloMiddleware(RequestDelegate _, IEnumerable<IHelloService> helloServices)
	    {
	        this.helloServices = helloServices;
	    }
	 
	    public async Task InvokeAsync(HttpContext context)
	    {
	        foreach (var service in helloServices)
	        {
	            ...
	        }
	    }
	}
	```
1. При регистрации **одной синглтон-реализации** на **несколько зависимостей** надо учитывать: 
	1. Если инициализацию экземпляра оставляем DI-контейнеру, то он создаст по экземпляру для каждой зависимости. 
		```csharp
		builder.Services.AddSingleton<IGenerator, ValueStorage>();
		builder.Services.AddSingleton<IReader, ValueStorage>();
		```
	
	2. Если же нужен один экземпляр на все зависимости - необходимо создать его вручную и передать DI-контейнеру при регистрации обеих зависимостей.
		```csharp
		var valueStorage = new ValueStorage();
		builder.Services.AddSingleton<IGenerator>(valueStorage);
		builder.Services.AddSingleton<IReader>(valueStorage);
		```
			или так
		```csharp
		builder.Services.AddSingleton<ValueStorage>();
		builder.Services.AddSingleton<IGenerator>(serv => serv.GetRequiredService<ValueStorage>());
		builder.Services.AddSingleton<IReader>(serv => serv.GetRequiredService<ValueStorage>());
		```

### Outer links:
https://metanit.com/sharp/aspnet6/4.7.php