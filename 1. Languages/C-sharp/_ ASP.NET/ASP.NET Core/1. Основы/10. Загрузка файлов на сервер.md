#lang #lang-c_sharp 

# 10. Загрузка файлов на сервер в ASP.NET Core

- Все загружаемые файлы в ASP.NET Core представлены типом `IFormFile` из пространства имен `Microsoft.AspNetCore.Http`:
	- `ContentType`: тип файла
	- `FileName`: название файла
	- `Length`: размер файла
	- `CopyTo/CopyToAsync`: копирует файл в поток
	- `OpenReadStream`: открывает поток файла для чтения
- JS: благодаря установке атрибута формы `enctype="multipart/form-data"` браузер будет знать, что вместе с формой надо передать файлы.
- Приложение получает коллекцию загруженных файлов с помощью свойства `Request.Form.Files`, которое представляет тип `IFormFileCollection`

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>METANIT.COM</title>
</head>
<body>
    <h2>Выберите файл для загрузки</h2>
    <form action="upload" method="post" enctype="multipart/form-data">
        <input type="file" name="uploads" /><br>
        <input type="file" name="uploads" /><br>
        <input type="file" name="uploads" /><br>
        <input type="submit" value="Загрузить" />
    </form>
</body>
</html>
```

```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.Run(async (context) =>
{
    var response = context.Response;
    var request = context.Request;
    response.ContentType = "text/html; charset=utf-8";
 
    if (request.Path == "/upload" && request.Method=="POST")
    {
        IFormFileCollection files = request.Form.Files; // Забираем файлы из запроса
        var uploadPath = $"{Directory.GetCurrentDirectory()}/uploads";
        Directory.CreateDirectory(uploadPath);
 
        foreach (var file in files)
        {
            string fullPath = $"{uploadPath}/{file.FileName}";
            using (var fileStream = new FileStream(fullPath, FileMode.Create))
            {
                await file.CopyToAsync(fileStream); // Копируем файл в поток записи
            }
        }
        await response.WriteAsync("Файлы успешно загружены");
    }
    else
    {
        await response.SendFileAsync("html/index.html");
    }
});
 
app.Run();
```

### Outer links:
https://metanit.com/sharp/aspnet6/2.12.php