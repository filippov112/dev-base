#lang #lang-c_sharp  
# <font color="#00b0f0">ASP.NET:</font> CORS

**CORS (Cross-Origin Resource Sharing)** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (origin) –∫ —Ä–µ—Å—É—Ä—Å–∞–º –¥—Ä—É–≥–æ–≥–æ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ SPA –Ω–∞ `http://localhost:3000` –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å `fetch` –∫ API –Ω–∞ `http://localhost:5000`, —Ç–æ —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è _–∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–º_, –∏ –±—Ä–∞—É–∑–µ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç CORS-–ø–æ–ª–∏—Ç–∏–∫—É. –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É, –∏ –±—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å, –¥–∞–∂–µ –µ—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω.

---

### ‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –≤ ASP.NET Core

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è CORS –≤ `Program.cs`:
```csharp
var builder = WebApplication.CreateBuilder(args);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CORS-—Å–µ—Ä–≤–∏—Å–∞ —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowFrontend", policy =>
    {
        policy.WithOrigins("http://localhost:3000") // —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–π origin
              .AllowAnyHeader()
              .AllowAnyMethod();
    });
});
```

CORS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á—ë–Ω **–¥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** –∏ **–¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**, –∏–Ω–∞—á–µ preflight-–∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
```csharp
var app = builder.Build();

// CORS ‚Üí Routing ‚Üí Auth ‚Üí Endpoints
app.UseCors("GlobalPolicy");      // –ì–ª–æ–±–∞–ª—å–Ω—ã–π CORS
app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
app.MapControllers();
app.Run();
```

üìå –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å CORS –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞:

```csharp
app.MapGet("/data", () => "Hello!")
   .RequireCors("AllowFrontend");
```

---

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
–° –∫–ª–∏–µ–Ω—Ç–∞ (`http://localhost:3000`), JS-–∑–∞–ø—Ä–æ—Å:
```javascript
fetch("http://localhost:5000/data")
  .then(res => res.text())
  .then(console.log)
  .catch(console.error);
```
–ï—Å–ª–∏ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –±—Ä–∞—É–∑–µ—Ä –≤—ã–ø–æ–ª–Ω–∏—Ç –∑–∞–ø—Ä–æ—Å.

#### ‚ùå –û—à–∏–±–∫–∞ CORS
–ï—Å–ª–∏ API –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç `localhost:3000`, –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞:
```
Access to fetch at 'http://localhost:5000/data' from origin 'http://localhost:3000'
has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present...
```

üìç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `curl`:
```bash
curl -i -H "Origin: http://localhost:3000" http://localhost:5000/data
```
–ï—Å–ª–∏ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç:
```
Access-Control-Allow-Origin: http://localhost:3000
```

### Outer links:
https://metanit.com/sharp/aspnet6/14.1.php