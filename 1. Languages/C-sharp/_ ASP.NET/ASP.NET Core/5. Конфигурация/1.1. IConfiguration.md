#lang #lang-c_sharp 
# <font color="#00b0f0">ASP.NET Core:</font> Конфигурация - `IConfiguration`

```csharp
//var builder = WebApplication.CreateBuilder();
//var app = builder.Build();
 
// установка настроек конфигурации
app.Configuration["name"] = "Tom";
app.Configuration["age"] = "37";
 
// через механизм внедрения зависимостей получим сервис IConfiguration
app.Map("/", (IConfiguration appConfig) => $"{appConfig["name"]} - {appConfig["age"]}");
```

**Методы:**
- `GetSection(name)` - возвращает определенную секцию
- `GetChildren() - возвращает все подсекции
- `GetReloadToken() - возвращает токен уведомления при изменении конфигурации
- `GetConnectionString(name)` = `GetSection("ConnectionStrings")[name]` - строки подключения к различным базам даных
- `[key]` - индексатор получения по ключу

**Методы подключения к источникам:**
- [2. Нефайловые провайдеры конфигурации](1.%20Languages/C-sharp/_%20ASP.NET/ASP.NET%20Core/5.%20Конфигурация/2.%20Нефайловые%20провайдеры%20конфигурации.md)
- [3. JSON, XML, INI - конфигурации](1.%20Languages/C-sharp/_%20ASP.NET/ASP.NET%20Core/5.%20Конфигурация/3.%20JSON,%20XML,%20INI%20-%20конфигурации.md)


---
### <font color="#e36c09">`IConfigurationRoot` - (наследник от `IConfiguration`)</font>

```csharp
public interface IConfigurationRoot : IConfiguration
{
    IEnumerable<IConfigurationProvider> Providers { get; }
    void Reload();
}
```
- `Providers` - возвращает коллекцию провайдеров
- `Reload()` - перезагружает значения источников

---
### <font color="#e36c09">Пакет `User Secrets` для секретов</font>
==Только для разработки! В `Production` используй **переменные окружения** или **Azure Key Vault**.==
1. **Активация User Secrets**
	```
	dotnet user-secrets init
	```
	Добавляет в `.csproj` элемент:
	```xml
	<UserSecretsId>unique-guid-here</UserSecretsId>
	```
	Создает файл 
		- Windows: `%APPDATA%\Microsoft\UserSecrets\<UserSecretsId>\secrets.json`
		- macOS/Linux: `~/.microsoft/usersecrets/<UserSecretsId>/secrets.json`


```csharp
// Для разработки: явно подключаем User Secrets (но обычно это уже включено)
if (builder.Environment.IsDevelopment())
{
    builder.Configuration.AddUserSecrets<Program>(); // Можно без этого, если UserSecretsId есть в .csproj
}
```


### Outer links:
https://metanit.com/sharp/aspnet6/6.1.php
https://metanit.com/sharp/aspnet6/6.5.php