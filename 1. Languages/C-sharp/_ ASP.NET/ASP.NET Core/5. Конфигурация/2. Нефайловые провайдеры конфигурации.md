#lang #lang-c_sharp 

# 2. Нефайловые провайдеры конфигурации в ASP.NET Core

1. **Командная строка**
Провайдер - `CommandLineConfigurationProvider`.
Источник - параметры командной строки.
Метод подключения - `AddCommandLine()` (не требуется, достаточно передать конструктору строителя словарь `args` метода `main`)
```csharp
	var builder = WebApplication.CreateBuilder(args);
	
	// или так:
	
	//var builder = WebApplication.CreateBuilder();
	//string[] commandLineArgs = { "name=Sam", "age=25" };  // псевдопараметры командной строки
	//builder.Configuration.AddCommandLine(commandLineArgs);  // передаем параметры в качестве конфигурации
	
	var app = builder.Build();
	 
	app.Map("/", (IConfiguration appConfig) => $"{appConfig["name"]} - {appConfig["age"]}");
	 
	app.Run();
```

2. **Переменные среды окружения**
Провайдер - `EnvironmentVariablesConfigurationProvider`
Источник - переменные среды окружения.
Метод подключения - `AddEnvironmentVariables()` (не требуется, т.к. ASP сам заносит окружение в конфигурацию приложения)

```csharp
	var builder = WebApplication.CreateBuilder();
	// builder.Configuration.AddEnvironmentVariables(); // не обязательно
	var app = builder.Build();
	 
	app.Map("/", (IConfiguration appConfig) => $"JAVA_HOME: {appConfig["JAVA_HOME"] ?? "not set"}");
	 
	app.Run();
```

3. **Словари в памяти приложения**
Провайдер - `MemoryConfigurationProvider`.
Источник - коллекции `IEnumerable<KeyValuePair<string, string>>`. 
Метод подключения - `AddInMemoryCollection()`.

```csharp
	var builder = WebApplication.CreateBuilder();
	var app = builder.Build();
	 
	builder.Configuration.AddInMemoryCollection(new Dictionary<string, string>
	{
	    {"name", "Tom"},
	    {"age", "37"}
	});
	 
	app.Map("/", (IConfiguration appConfig) =>
	{
	    var name = appConfig["name"];
	    var age = appConfig["age"];
	    return $"{name} - {age}";
	});
	 
	app.Run();
```

---

> #### Работа с командной строкой
> 
> **Правила передачи параметров через командную строку:**
> - Обычно разделяем через ` `, ключ-значения через `=`.
> - Если перед ключом указать префикс `--` или `/`, тогда между ключом и значением можно опустить знак равно `=` и оставить просто пробел
> - Значения указывать не обязательно.
> 	```
> 	key1=value1 --key2=value2 /key3=value3
> 	--key1 value1 /key2 value2
> 	key1= key2=value2
> 	```
> 
> **Тестирование параметров командной строки:**
> - Через терминал:
> 	```bash
> 	dotnet run name=Tom age=35
> 	```
> 
> - Через файл настроек:
> 	```json
> 	// Properties/launchSettings.json
> 	"commandLineArgs": "name=Bob age=37",
> 	```
> 
> - Через имитацию передачи параметров:
> 	```csharp
> 	string[] commandLineArgs = { "name=Alice", "age=29" };  // псевдопараметры командной строки
> 	var builder = WebApplication.CreateBuilder(commandLineArgs);
> 	```

### Outer links:
https://metanit.com/sharp/aspnet6/6.2.php