#lang #lang-c_sharp #aspnet

---
### StatusCodePagesMiddleware

Предназначен для обработки ошибочных статусных кодов запросов.
**Методы:**
- `UseStatusCodePages()`.
- `app.UseStatusCodePagesWithRedirects()` - выполняет переадресацию на другой маршрут (код 302)
- `app.UseStatusCodePagesWithReExecute()` - также переадресовывает запрос, но с кодом 404 вместо 302.

Следует вызывать ближе к началу конвейера, до добавления middleware для работы со статическими файлами и до добавления конечных точек.

### Примеры

**Пример:**
```csharp
app.UseStatusCodePages();
```

**Пример с информативной перегрузкой:**
```csharp
app.UseStatusCodePages("text/plain", "Error: Resource Not Found. Status code: {0}");
```

**Пример с обработчиком:**
- `StatusCodeContext` имеет свойство `HttpContext`.
```csharp
app.UseStatusCodePages(async statusCodeContext =>
{
    var response = statusCodeContext.HttpContext.Response;
    var path = statusCodeContext.HttpContext.Request.Path;
 
    response.ContentType = "text/plain; charset=UTF-8";
    if (response.StatusCode == 403)
    {
        await response.WriteAsync($"Path: {path}. Access Denied ");
    }
    else if (response.StatusCode == 404)
    {
        await response.WriteAsync($"Resource {path} Not Found");
    }
});
```

**Пример с переадресацией:**
```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.UseStatusCodePagesWithRedirects("/error/{0}");
 
app.Map("/hello", () => "Hello ASP.NET Core");
app.Map("/error/{statusCode}", (int statusCode) => $"Error. Status Code: {statusCode}");
 
app.Run();
```

```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.UseStatusCodePagesWithReExecute("/error/{0}");
 
app.Map("/hello", () => "Hello ASP.NET Core");
app.Map("/error/{statusCode}", (int statusCode) => $"Error. Status Code: {statusCode}");
 
app.Run();
```

```csharp
var builder = WebApplication.CreateBuilder();
var app = builder.Build();
 
app.UseStatusCodePagesWithReExecute("/error", "?code={0}");
 
app.Map("/hello", () => "Hello ASP.NET Core");
app.Map("/error",  (string code) => $"Error Code: {code}");
 
 
app.Run();
```

### Outer links:
https://metanit.com/sharp/aspnet6/9.2.php