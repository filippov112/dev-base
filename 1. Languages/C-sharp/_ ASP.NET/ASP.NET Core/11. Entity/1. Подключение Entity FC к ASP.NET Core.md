#lang #lang-c_sharp 

# 1. Подключение Entity FC к ASP.NET Core

1. Для работы с базами данных *MS SQL Server* через *Entity Framework Core* необходим пакет *Microsoft.EntityFrameworkCore.SqlServer*. Добавляем через пакетный менеджер Nuget.
2. Создаем класс данных
```csharp
public class User
{
    public int Id { get; set; }
    public string Name { get; set; } = ""; // имя пользователя
    public int Age { get; set; } // возраст пользователя
}
```

3. Создаем контекст данных (наследник от `Microsoft.EntityFrameworkCore.DbContext`)
```csharp
public class ApplicationContext : DbContext
{
    public DbSet<User> Users { get; set; } = null!; // таблица. null! - данное свойство не будет иметь значение null. Конструктор базового класса DbContext гарантирует, что все свойства типа DbSet будут инициализированы.
    public ApplicationContext(DbContextOptions<ApplicationContext> options)
        : base(options) // передаем настройки контекста
    {
        Database.EnsureCreated();   // создаем базу данных при первом обращении
    }
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<User>().HasData(
                new User { Id = 1, Name = "Tom", Age = 37 },
                new User { Id = 2, Name = "Bob", Age = 41 },
                new User { Id = 3, Name = "Sam", Age = 24 }
        ); // начальная конфигурация
    }
}
```

4. Добавляем в файл конфигурации данные о подключении (`appsettings.json`). Либо можно указать в коде.
```json
{
	"ConnectionStrings": {
		"DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=applicationdb;Trusted_Connection=True;"
	},
}

```

5. Подключаем контекст данных как сервис.
```csharp
using Microsoft.EntityFrameworkCore;
 
var builder = WebApplication.CreateBuilder();
 
// получаем строку подключения из файла конфигурации
string connection = builder.Configuration.GetConnectionString("DefaultConnection");
 
// добавляем контекст ApplicationContext в качестве сервиса в приложение
builder.Services.AddDbContext<ApplicationContext>(options => options.UseSqlServer(connection));
 
var app = builder.Build();
 
app.Run();
```

6. Через DI получаем доступ к контексту и через него обращаемся к базе.
```csharp
app.MapGet("/", (ApplicationContext db) => db.Users.ToList());
```


### Outer links:
https://metanit.com/sharp/aspnet6/12.1.php