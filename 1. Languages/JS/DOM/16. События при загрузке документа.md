#lang #lang-js 

# 16. События при загрузке документа

События, возникающие при загрузке HTML-документа и при его обновлении в браузере:
- **DOMContentLoaded** – браузер полностью загрузил HTML, было построено DOM-дерево, но внешние ресурсы, такие как картинки (img) и стили (CSS), могут быть ещё не загружены;
- **load** – браузер загрузил HTML и внешние ресурсы (картинки, стили и т.д.);
- **beforeunload/unload** – пользователь покидает страницу. (для предупреждений / для отправки статистики)

### **DOMContentLoaded**

- Возникает после выполнения всех скриптов (а если скрипты предполагают подгрузку CSS стилей, то ещё и после их подгрузки).
- Исключение. На это событие не влияют следующие скрипты:
  - Скрипты с атрибутом `async`
  - Скрипты, сгенерированные динамически при помощи `document.createElement('script')`

### **Unload**

- `navigator.sendBeacon(url, data);` — служит для отправки данных на сервер.

```javascript
navigator.sendBeacon("/analytics.php", JSON.stringify(myData));
```

- События типа `load`, `unload`, `beforeunload` – вешаются на окно целиком `window.addEventListener(...)`

### **Beforeunload**

- Обычная реализация предупреждения:

```javascript
window.onbeforeunload = function() {
    return false;
};
```

### **Свойство** `document.readyState`

Принимает разные значения в зависимости от текущего состояния документа:
- **"loading"** – документ в процессе загрузки;
- **"interactive"** – документ был полностью прочитан (парсинг документа завершен);
- **"complete"** – документ был полностью прочитан и все ресурсы (изображения, стили и т.п.) тоже загружены.

### **Устаревшее событие** `readystatechange`

Возникает при изменении **readyState**.

```javascript
document.addEventListener('readystatechange', function() {
    console.log(document.readyState);
});
```
