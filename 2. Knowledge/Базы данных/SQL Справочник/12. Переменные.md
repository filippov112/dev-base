#db #sql

# Переменные в SQL

**Переменные** - позволяют хранить временные данные, которые могут использоваться в *запросах*, *процедурах* и *триггерах*. 

**Общие принципы работы с переменными:**
- Переменные объявляются в начале блока кода или процедуры.
- Используются для хранения значений, которые можно затем использовать в SQL-запросах.
- Переменные могут быть локальными (доступны только внутри блока кода) или глобальными (доступны в разных контекстах).

---

# В запросах

## **T-SQL (SQL Server)**

> ### Объявление переменных
> ```sql
> DECLARE @VariableName DataType;
> ```
> **Пример:**
> ```sql
> DECLARE @EmployeeCount INT;
> ```
> 
> ### Присваивание значения переменной
> ```sql
> SET @VariableName = Value;
> ```
> **Пример:**
> ```sql
> SET @EmployeeCount = (SELECT COUNT(*) FROM Employees);
> ```
> 
> ### Использование переменной в запросе
> ```sql
> SELECT * FROM Employees WHERE DepartmentID = @DepartmentID;
> ```
> **Пример:**
> ```sql
> DECLARE @DepartmentID INT;
> SET @DepartmentID = 1;
> SELECT * FROM Employees WHERE DepartmentID = @DepartmentID;
> ```
> 
> ### Вывод значения переменной
> ```sql
> PRINT @VariableName;
> ```
> **Пример:**
> ```sql
> PRINT @EmployeeCount;
> ```

---

## **PostgreSQL (PL/pgSQL)**

> ### Объявление переменных
> ```sql
> DECLARE
>     VariableName DataType;
> ```
> **Пример:**
> ```sql
> DO $$
> DECLARE
>     EmployeeCount INT;
> BEGIN
>     SELECT COUNT(*) INTO EmployeeCount FROM Employees;
>     RAISE NOTICE 'Employee count: %', EmployeeCount;
> END $$;
> ```
> 
> ### Присваивание значения переменной
> ```sql
> SELECT Value INTO VariableName;
> ```
> **Пример:**
> ```sql
> SELECT COUNT(*) INTO EmployeeCount FROM Employees;
> ```
> 
> ### Использование переменной в запросе
> ```sql
> SELECT * FROM Employees WHERE DepartmentID = DepartmentIDValue;
> ```
> **Пример:**
> ```sql
> DO $$
> DECLARE
>     DepartmentID INT := 1;
> BEGIN
>     SELECT * FROM Employees WHERE DepartmentID = DepartmentID;
> END $$;
> ```
> 
> ### Вывод значения переменной
> ```sql
> RAISE NOTICE 'Message: %', VariableName;
> ```
> **Пример:**
> ```sql
> RAISE NOTICE 'Employee count: %', EmployeeCount;
> ```

---

## **MySQL**

> ### Объявление переменных
> ```sql
> SET @VariableName = Value;
> ```
> **Пример:**
> ```sql
> SET @EmployeeCount = (SELECT COUNT(*) FROM Employees);
> ```
> 
> ### Использование переменной в запросе
> ```sql
> SELECT * FROM Employees WHERE DepartmentID = @DepartmentID;
> ```
> **Пример:**
> ```sql
> SET @DepartmentID = 1;
> SELECT * FROM Employees WHERE DepartmentID = @DepartmentID;
> ```
> 
> ### Вывод значения переменной
> ```sql
> SELECT @VariableName;
> ```
> **Пример:**
> ```sql
> SELECT @EmployeeCount AS 'Employee Count';
> ```

---


# В хранимых процедурах

### **T-SQL (SQL Server)**

#### Объявление переменных в процедуре:
```sql
CREATE PROCEDURE GetEmployeeCount
AS
BEGIN
    DECLARE @EmployeeCount INT;
    SET @EmployeeCount = (SELECT COUNT(*) FROM Employees);
    PRINT @EmployeeCount;
END;
```

### **PostgreSQL**

#### Объявление переменных в процедуре:
```sql
CREATE OR REPLACE FUNCTION GetEmployeeCount()
RETURNS VOID AS $$
DECLARE
    EmployeeCount INT;
BEGIN
    SELECT COUNT(*) INTO EmployeeCount FROM Employees;
    RAISE NOTICE 'Employee count: %', EmployeeCount;
END;
$$ LANGUAGE plpgsql;
```

### **MySQL**

#### Объявление переменных в процедуре:
```sql
CREATE PROCEDURE GetEmployeeCount()
BEGIN
    DECLARE EmployeeCount INT;
    SELECT COUNT(*) INTO EmployeeCount FROM Employees;
    SELECT EmployeeCount AS 'Employee Count';
END;
```

---

# Глобальные переменные

Некоторые СУБД поддерживают глобальные переменные, которые можно использовать в разных сессиях или контекстах, но их реализация может варьироваться.

### Пример использования глобальных переменных в MySQL:
```sql
SET GLOBAL max_connections = 200;
```

> [!note] В T-SQL и PostgreSQL нет явной поддержки глобальных переменных, но можно использовать таблицы или системные параметры для хранения глобальных значений.

