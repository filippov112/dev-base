#db 
# <font color="#00b0f0">DB:</font> Оптимизация запросов

Оптимизация запросов в MS SQL Server включает в себя несколько ключевых стратегий:

1. **Использование индексов**
    - Добавление кластерных и некластерных индексов для ускорения поиска.
    - Включение в индекс необходимых полей (`INCLUDE`).
    - Использование индексированных представлений.
    - Проверка наличия индексов на полях соединения (`JOIN`).
	<br>
2. **Оптимизация условий фильтрации**
    - Использование `WHERE` вместо `HAVING` (если возможно).
	- Исключение функций в условиях (`WHERE YEAR(date) = 2024` → `WHERE date >= '2024-01-01' AND date < '2025-01-01'`).
	<br>
3. **Работа с `JOIN`**
    - Выбор правильного типа соединения (например, `INNER JOIN` быстрее `LEFT JOIN`, если внешний ключ обязателен).
	<br>
4. **Избегание избыточных данных**
    - Указание необходимых полей в `SELECT`, а не `SELECT *`.
    - Ограничение выборки через `TOP` или `OFFSET FETCH`.
	<br>
5. **Использование правильных типов данных**
    - Минимизация размера полей (`VARCHAR(100)` вместо `VARCHAR(MAX)`, `INT` вместо `BIGINT`, если нет необходимости).
    - Приведение типов данных в `JOIN` и `WHERE` к одинаковым типам.
	<br>
6. **Оптимизация агрегатных функций**
    - Использование предварительно рассчитанных данных (материализованные представления, таблицы с агрегацией).
    - Перенос вычислений на уровень клиентского приложения, если это возможно.
	<br>
7. **Использование параметризованных запросов**
    - Исключение динамического SQL для предотвращения повторной компиляции запросов.
	<br>
8. **Очистка и обновление статистики**
    - Регулярное обновление статистики (`UPDATE STATISTICS`).
    - Перестроение индексов (`ALTER INDEX ... REBUILD` или `REORGANIZE`).
	<br>
9. **Использование `TABLE VARIABLE` и `TEMP TABLE` правильно**
    - Временные таблицы (`#TempTable`) эффективны для больших данных.
    - Табличные переменные (`@TableVar`) подходят для небольших объемов.
	<br>
10. **Анализ плана выполнения (`Execution Plan`)**
	- Выявление узких мест (`Clustered Index Scan`, `Hash Join`, `Sort`).
	- Проверка предупреждений о конверсии типов и пропущенных индексах.

