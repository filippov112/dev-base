#alg_sorting
# Сортировка кучей

**Сортировка кучей** (или **Heap Sort**) — это алгоритм сортировки, который использует структуру данных **кучу**. Куча — это дерево, в котором для каждого родительского элемента выполняется определённое условие (в максимальной куче родитель больше или равен своим детям, в минимальной куче — наоборот).

### **Пример**

Допустим, есть массив:  
`[4, 10, 3, 5, 1]`

Алгоритм сортировки кучей работает следующим образом:

1. **Построение кучи**: преобразуем массив в кучу. Для этого мы начинаем с последнего родительского узла и проверяем, чтобы каждый родитель был больше своих детей (для максимальной кучи).
2. **Извлечение элементов**: извлекаем максимальный элемент (первый элемент в куче) и заменяем его с последним элементом массива. Затем восстанавливаем кучу для оставшихся элементов.
3. Повторяем процесс до тех пор, пока не отсортируем массив.

### Шаги на примере:

Массив: `[4, 10, 3, 5, 1]`

1. Строим кучу:
    
    - Начинаем с последнего родителя (индекс 1, элемент `10`). Он уже удовлетворяет условию кучи.
    - Проверяем элемент с индексом 0 (`4`). Его нужно заменить с `10`, так как `10` больше. Теперь массив выглядит так: `[10, 4, 3, 5, 1]`.
2. Извлекаем максимальный элемент (`10`), заменяем его с последним элементом (`1`), и восстанавливаем кучу для оставшихся элементов. Массив: `[1, 4, 3, 5]`.
    
3. Повторяем процесс для оставшихся элементов, пока весь массив не будет отсортирован.
    

### **Сложность**

- **Лучший, худший и средний случай** — O(n log n), где n — количество элементов в массиве.
- Алгоритм всегда имеет одинаковую сложность, независимо от исходного порядка элементов.

### **Реализация на C#**

```csharp
using System;

class Program
{
    // Функция для восстановления кучи
    static void Heapify(int[] array, int n, int i)
    {
        int largest = i;
        int left = 2 * i + 1;
        int right = 2 * i + 2;

        // Проверяем левый дочерний элемент
        if (left < n && array[left] > array[largest])
            largest = left;

        // Проверяем правый дочерний элемент
        if (right < n && array[right] > array[largest])
            largest = right;

        // Если дочерний элемент больше родительского, меняем их местами
        if (largest != i)
        {
            int temp = array[i];
            array[i] = array[largest];
            array[largest] = temp;

            // Рекурсивно восстанавливаем кучу
            Heapify(array, n, largest);
        }
    }

    // Основная функция сортировки кучей
    static void HeapSort(int[] array)
    {
        int n = array.Length;

        // Строим кучу (переводим массив в кучу)
        for (int i = n / 2 - 1; i >= 0; i--)
            Heapify(array, n, i);

        // Извлекаем элементы из кучи по одному
        for (int i = n - 1; i > 0; i--)
        {
            // Меняем местами корень кучи (максимальный элемент) с последним элементом
            int temp = array[0];
            array[0] = array[i];
            array[i] = temp;

            // Восстанавливаем кучу для оставшихся элементов
            Heapify(array, i, 0);
        }
    }

    static void Main()
    {
        int[] numbers = { 4, 10, 3, 5, 1 };
        HeapSort(numbers);

        Console.WriteLine("Отсортированный массив:");
        foreach (var num in numbers)
            Console.Write(num + " ");
    }
}
```

Этот код:

1. Строит кучу из исходного массива.
2. Извлекает максимальные элементы, сортируя их на каждом шаге.
3. Выводит отсортированный массив.

### Outer links:

