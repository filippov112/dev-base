#lang #lang-python #flask

---
## Обработчики ошибок

- `@app.errorhandler(404)` - декоратор обработчика для соответствующего кода ошибки (в скобках).
  
- `return redirect()` - перенаправляет пользователя на другой обработчик (страницу).
  
- `abort(401)` - прерывает работу обработчика и возвращает указанный код ошибки.

---

## Пример использования `redirect` для формы авторизации пользователя

> **Предварительно были импортированы функции `redirect` и `url_for` (так же и `abort`).**

```python
@app.route("/login", methods=["POST", "GET"])
def login():
    if 'userLogged' in session:  # проверка наличия в сессии изначально не существующего св-ва
        return redirect(url_for('profile', username=session['userLogged']))
        # 1 вариант: свойство есть. Пользователь уже авторизован. 
        # Происходит перенаправление на обработчик страницы профиля, 
        # с экспортом логина из сохр. данных сессии.

    elif request.method == "POST" and request.form['username'] == "selfedu" and request.form['psw'] == "123":
        session['userLogged'] = request.form['username']
        return redirect(url_for('profile', username=session['userLogged']))
        # 2 вариант: Пользователь отправляет свои данные серверу для авторизации. 
        # Проверяется соответствие данных формы имеющейся базе (selfedu - 123). 
        # В случае успеха создаётся ранее не существующая запись в сессии 
        # с сохранением в нее логина пользователя. После чего происходит перенаправление на обработчик профиля.

    return render_template('login.html', title="Авторизация", menu=menu)
    # 3 вариант: Пользователь первый раз зашёл на сайт или неверно указал данные авторизации.
    # Возвращается исходная страница авторизации.
```

---

## Пример использования `abort` на той же авторизации для запрета доступа к страницам других пользователей

```python
@app.route("/profile/<username>")
def profile(username):
    if 'userLogged' not in session or session['userLogged'] != username:
        abort(401)
        # Если в сессии отсутствует запись об авторизации пользователя или запись есть, 
        # но пользователь пытается перейти на чужую страницу профиля, 
        # срабатывает прерывание обработчика. Вызывается требуемое исключение, 
        # по которому срабатывает соответствующий обработчик (если мы его прописали).

    return f"Пользователь: {username}"
    # В случае штатной ситуации обработчик срабатывает до конца.
```
