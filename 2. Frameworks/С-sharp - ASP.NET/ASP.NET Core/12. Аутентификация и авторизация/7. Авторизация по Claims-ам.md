#lang #lang-c_sharp #aspnet

---
**Claim** ‚Äî —ç—Ç–æ –ø–∞—Ä–∞ ¬´—Ç–∏–ø-–∑–Ω–∞—á–µ–Ω–∏–µ¬ª, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–º—è, —Ä–æ–ª—å, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, —Å—Ç—Ä–∞–Ω–∞ –∏ —Ç.–¥. Claims –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–æ–ª–∏—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚Äî –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö claims —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `AuthorizationOptions` –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç `[Authorize(Policy = "PolicyName")]`.

---
### ‚öôÔ∏è AuthorizationOptions
–ö–ª–∞—Å—Å `AuthorizationOptions` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–∏—Ç–∏–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- `Policies` ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (`IDictionary<string, AuthorizationPolicy>`).
- `AddPolicy(string name, Action<AuthorizationPolicyBuilder> configurePolicy)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –ø–æ–ª–∏—Ç–∏–∫—É.
- `GetPolicy(string name)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –ø–æ –∏–º–µ–Ω–∏.
- `InvokeHandlersAfterFailure` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–∫–∞–∑–∞.

```csharp
builder.Services.AddAuthorization(options => // <==
{
    options.AddPolicy("HasCountryClaim", policy =>
        policy.RequireClaim("country", "USA", "Canada"));
});
```

---
### üß± AuthorizationPolicyBuilder
–ö–ª–∞—Å—Å –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `AuthorizationPolicy`.
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤ –ø–æ–ª–∏—Ç–∏–∫—É, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AuthorizationPolicyBuilder`:
- `RequireClaim(string type)` ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è claim —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Ç–∏–ø–æ–º.
- `RequireClaim(string type, params string[] values)` ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ claim —Å —Ç–∏–ø–æ–º –∏ –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.
- `RequireRole(params string[] roles)` ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π.
- `RequireAuthenticatedUser()` ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `AddRequirements(IAuthorizationRequirement requirement)` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ [–∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π](2.%20Frameworks/–°-sharp%20-%20ASP.NET/ASP.NET%20Core/12.%20–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è%20–∏%20–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è/8.%20–ö–∞—Å—Ç–æ–º–Ω—ã–µ%20claims-–ø–æ–ª–∏—Ç–∏–∫–∏%20–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.md)
- `Build()` ‚Äî –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AuthorizationPolicy`.

```csharp
options.AddPolicy("CustomPolicy", policy =>
{
    policy.RequireAuthenticatedUser();
    policy.Requirements.Add(new MinimumAgeRequirement(21));
    policy.RequireClaim("country", "USA");
});
```

---
### üè∑ –ê—Ç—Ä–∏–±—É—Ç `[Authorize]`
–ê—Ç—Ä–∏–±—É—Ç, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
–ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –º–µ—Ç–æ–¥ –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ.

–í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```csharp
[Authorize] // –ø—Ä–æ—Å—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
[Authorize(Roles = "Admin")] // –ø–æ —Ä–æ–ª–∏
[Authorize(Policy = "HasCountryClaim")] // –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ
```

---

### üõ† –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ claims

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ `Program.cs` –∏–ª–∏ `Startup.cs`:
```csharp
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("HasCountryClaim", policy =>
        policy.RequireClaim("country", "USA", "Canada"));
});
```
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ claims –ø—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):
```csharp
var claims = new List<Claim>
{
    new Claim(ClaimTypes.Name, "Alice"),
    new Claim("country", "USA")
};

var identity = new ClaimsIdentity(claims, "custom");
var principal = new ClaimsPrincipal(identity);
await HttpContext.SignInAsync(principal);
```
–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏:
```csharp
[Authorize(Policy = "HasCountryClaim")]
public IActionResult RestrictedAction()
{
    return View();
}
```



### Outer links:
https://metanit.com/sharp/aspnet6/13.8.php