#lang #lang-c_sharp #aspnet 

---
**OutputCache** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è HTTP-–æ—Ç–≤–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –±–µ–∑ –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
- **`IOutputCacheStore`** ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫—ç—à–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.
- **`OutputCacheMiddleware`** ‚Äî –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–∞ –∏ –∫—ç—à–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç.

```csharp
builder.Services.AddOutputCache();
//...
app.UseOutputCache();
```

### üèó <font color="#ffff00">**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è -** `OutputCacheOptions`</font>

##### üîç **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `DefaultExpirationTimeSpan` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- `SizeLimit` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –∫—ç—à–∞.
- `UseCaseSensitivePaths` ‚Äî —É—á–∏—Ç—ã–≤–∞—Ç—å –ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä –≤ URL.

```csharp
builder.Services.AddOutputCache(options =>
{
    options.DefaultExpirationTimeSpan = TimeSpan.FromMinutes(1);
});
```

##### üìå **–ë–∞–∑–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:** 
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∫—ç—à–∏—Ä—É–µ–º—ã–º –∑–∞–ø—Ä–æ—Å–∞–º.
- –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–Ω—ã–º –∫–æ–¥–æ–º 200
- –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã —Ç–∏–ø–∞ GET –∏ HEAD
- –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫—É–∫–∏, —Ç–æ –æ—Ç–≤–µ—Ç –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è
```csharp
builder.Services.AddOutputCache(options =>
{
    options.AddBasePolicy(builder => builder.Expire(TimeSpan.FromSeconds(30)));
});
```

##### üìå **–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏:** 
- –ù—É–∂–Ω—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
```csharp
builder.Services.AddOutputCache(options =>
{
    options.AddPolicy("LongCache", builder => builder.Expire(TimeSpan.FromMinutes(10)));
});

app.MapGet("/longcache", () => DateTime.UtcNow).CacheOutput("LongCache"); // –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É

app.MapGet("/", [OutputCache(PolicyName ="LongCache")] () => users); // —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç
```

---

### üöÄ <font color="#ffff00">**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫**</font>

##### 1. üìå **–ß–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç `CacheOutput`**
```csharp
[CacheOutput(Duration = 30)] // –ö—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.
[HttpGet("data")]
public IActionResult GetData() => Ok(new { Time = DateTime.UtcNow });
```
- `int Duration`: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `string[]? VaryByHeaderNames`: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–æ–∫–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫—ç—à
- `string[]? VaryByQueryKeys`: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø—Ä–æ—Å–∞, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫—ç—à
- `string[]? VaryByRouteValueNames`: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫—ç—à

##### 2. üìå **–ß–µ—Ä–µ–∑ `CacheOutput()` –≤ `Minimal API`**
```csharp
app.MapGet("/policy", () => DateTime.UtcNow)
   .CacheOutput(policy => policy
	   .Expire(TimeSpan.FromSeconds(60))
	   .SetVaryByQuery("id")
	   .Tag("time"));
```

**`OutputCachePolicyBuilder`**:
- `Expire(TimeSpan duration)` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞.
- `SetVaryByQuery("param")` ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ—Ç–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞.
- `SetVaryByHeader (string[] headerNames)` ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å–≤–æ—è –≤–µ—Ä—Å–∏—è –∫—ç—à–∞
- `SetVaryByHost (bool enabled)` ‚Äî –µ—Å–ª–∏¬†`true`, —Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–≤–æ—è –≤–µ—Ä—Å–∏—è –∫—ç—à–∞.
- `SetVaryByRouteValue (string[] routeValueNames)` ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤–æ—é –≤–µ—Ä—Å–∏—é –∫—ç—à–∞ –¥–ª—è –Ω–∞–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥
- `Tag("tag")` ‚Äî –º–µ—Ç–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≥—Ä—É–ø–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

##### üîÑ **–ú–µ—Ç–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–±—Ä–æ—Å –∫—ç—à–∞**
üìå **–°–±—Ä–æ—Å –≤—Å–µ—Ö –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```csharp
var cacheStore = app.Services.GetRequiredService<IOutputCacheStore>();

await cacheStore.EvictByTagAsync("time", CancellationToken.None); // –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å –º–µ—Ç–∫–æ–π `"time"`.
```

---
### Outer links:
https://metanit.com/sharp/aspnet6/17.5.php