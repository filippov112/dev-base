#lang #lang-c_sharp #aspnet

---
Поскольку механизм DI в ASP позволяет внедрять конфигурацию приложения как сервис, то тем же способом можно внедрять не просто конфигурацию, а связанные с ней типы, которые будут формироваться путем проекции. [6. Проекция конфигурации на классы](2.%20Frameworks/С-sharp%20-%20ASP.NET/ASP.NET%20Core/5.%20Конфигурация/6.%20Проекция%20конфигурации%20на%20классы.md)

#### Для этого необходимо:

##### 1. Зарегистрировать нужные проекции с помощью метода `Configure()`:

```csharp
public static IServiceCollection Configure<TOptions>(this IServiceCollection services, IConfiguration config) where TOptions : class
public static IServiceCollection Configure<TOptions>(this IServiceCollection services, IConfiguration config, Action<BinderOptions> configureBinder) where TOptions : class
public static IServiceCollection Configure<TOptions>(this IServiceCollection services, string name, IConfiguration config) where TOptions : class
public static IServiceCollection Configure<TOptions>(this IServiceCollection services, string name, IConfiguration config, Action<BinderOptions> configureBinder)
```

**Пример:**
```csharp
// Можно связать тип со всей конфигурацией
builder.Services.Configure<Person>(builder.Configuration);
// Можно переопределять какие-то поля типа
builder.Services.Configure<Person>(opt =>
{
    opt.Age = 22;
});
// Можно связывать тип с отдельной секцией конфигурации
builder.Services.Configure<Company>(builder.Configuration.GetSection("company"));
```


##### 2. Получить через DI экземпляр нужного типа, обернутый в тип `IOptions<TOptions>`
**Пример:**
```csharp
app.Map("/", (IOptions<Person> options) =>
{
    Person person = options.Value;  // получаем переданные через Options объект Person
    return person;
});
```


### Outer links:
https://metanit.com/sharp/aspnet6/6.8.php