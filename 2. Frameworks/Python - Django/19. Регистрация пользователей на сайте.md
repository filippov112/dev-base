#lang #lang-python #django

---
Django предоставляет встроенный функционал для регистрации пользователей. При инициализации БД создаётся в числе прочих таблица пользователей `User`. В ней имеются поля: логин, пароль, email, имя, фамилия. Просмотреть ключи доступа к полям (пункт 5) можно через админ-панель [http://127.0.0.1:8000/admin/auth/user/](http://127.0.0.1:8000/admin/auth/user/).

---

## 1. Создаем ссылки на страницы

```html
<a href="{% url 'register' %}">Регистрация</a> | <a href="{% url 'login' %}">Войти</a>
```

---

## 2. Регистрируем адрес класса представления регистрации

```python
path('register/', RegisterUser.as_view(), name='register')
```

---

## 3. Прописываем представление

```python
class RegisterUser(DataMixin, CreateView):
    # тип представления CreateView (для форм)
    form_class = RegisterUserForm  # указываем свою форму
    template_name = 'women/register.html'
    success_url = reverse_lazy('login')  # перенаправляем пользователя на авторизацию

    def get_context_data(self, *, object_list=None, **kwargs):
        context = super().get_context_data(**kwargs)
        c_def = self.get_user_context(title="Регистрация")
        return dict(list(context.items()) + list(c_def.items()))
```

---

## 4. Прописываем форму в шаблоне

```html
<form method="post">
    {% csrf_token %}
    {% for f in form %}
        <p><label class="form-label" for="{{ f.id_for_label }}">{{f.label}}:</label>{{ f }}</p>
        <div class="form-error">{{ f.errors }}</div>
    {% endfor %}
    <button type="submit">Регистрация</button>
</form>
```

---

## 5. Создаем свою форму на основе базовой формы UserCreationForm

```python
class RegisterUserForm(UserCreationForm):
    # Переопределяем стандартные поля для возможности их кастомизации
    username = forms.CharField(label='Логин', widget=forms.TextInput(attrs={'class': 'form-input'}))
    password1 = forms.CharField(label='Пароль', widget=forms.PasswordInput(attrs={'class': 'form-input'}))
    password2 = forms.CharField(label='Повтор пароля', widget=forms.PasswordInput(attrs={'class': 'form-input'}))
    
    # Можем добавить свои поля
    email = forms.EmailField(label='Email', widget=forms.EmailInput(attrs={'class': 'form-input'}))

    class Meta:
        model = User  # связываем форму со стандартной таблицей
        fields = ('username', 'email', 'password1', 'password2')

    # Кастомизация стандартных полей через виджет-Meta невозможна (только для пользовательских полей)
    # widgets = {
    #     'username': forms.TextInput(attrs={'class': 'form-input'}),
    #     'password1': forms.PasswordInput(attrs={'class': 'form-input'}),
    #     'password2': forms.PasswordInput(attrs={'class': 'form-input'}),
    # }
```
