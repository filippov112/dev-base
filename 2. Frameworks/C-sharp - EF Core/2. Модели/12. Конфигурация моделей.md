#lang #lang-c_sharp #efcore 

---
**Суть проблемы:**
Настройки сущностей (таблицы, столбцы, ограничения) можно задавать через **Fluent API** в методе `OnModelCreating()`.  
При большом количестве сущностей и сложных настройках метод <u>`OnModelCreating` становится перегруженным и сложным для поддержки</u>.  

---
#### **Вынесение конфигурации в отдельные классы**  
Создание отдельных классов конфигурации, реализующих интерфейс `IEntityTypeConfiguration<T>`.  

```csharp
public class UserConfiguration : IEntityTypeConfiguration<User>
{
    public void Configure(EntityTypeBuilder<User> builder)
    {
        builder.ToTable("People").Property(p => p.Name).IsRequired();
        builder.Property(p => p.Id).HasColumnName("user_id");
    }
}
```  

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.ApplyConfiguration(new UserConfiguration());
    modelBuilder.ApplyConfiguration(new CompanyConfiguration());
}
```  
---
#### **Методы внутри контекста**  
Если не хочется создавать отдельные классы, можно вынести конфигурацию в методы внутри `DbContext`:  

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity(UserConfigure);
    modelBuilder.Entity(CompanyConfigure);
}

public void UserConfigure(EntityTypeBuilder<User> builder)
{
    builder.ToTable("People").Property(p => p.Name).IsRequired();
    builder.Property(p => p.Id).HasColumnName("user_id");
}
```  
---
#### **Использование атрибута `[EntityTypeConfiguration]` (EF7+)**  
- Позволяет связать сущность с классом конфигурации через атрибут.  
- Не требует явного вызова `ApplyConfiguration()`.  
- Автоматическое применение конфигурации.

```csharp
[EntityTypeConfiguration(typeof(UserConfiguration))]
public class User { ... }

public class UserConfiguration : IEntityTypeConfiguration<User> { ... }
```  

---
### Outer links:
https://metanit.com/sharp/efcore/2.13.php