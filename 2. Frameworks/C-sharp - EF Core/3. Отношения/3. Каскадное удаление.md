#lang #lang-c_sharp #efcore

---
**Каскадное удаление** – автоматическое удаление зависимых сущностей при удалении главной.  
Применяется по умолчанию, если зависимая сущность **обязательно** должна быть связана с главной.  

#### **Условия для каскадного удаления**  

1. **Не-nullable ключ** 
   ```csharp
   public class User
   {
       public int Id { get; set; }
       public int CompanyId { get; set; } // Обязательная связь → каскадное удаление
       public Company? Company { get; set; }
   }
   ```  
2. **Не-nullable нав. св-во**
   ```csharp
   public Company Company { get; set; } // Не-nullable → каскадное удаление
   ```  
3. **`[Required]`**  
   ```csharp
   [Required]
   public Company? Company { get; set; } // Требует связи → каскадное удаление
   ```  

---
### **Настройка через Fluent API**  

Метод `OnDelete()` позволяет явно задать поведение:  
- **`Cascade`** – зависимые сущности удаляются.  
- **`SetNull`** – внешний ключ устанавливается в `NULL` (если допустимо).  
- **`Restrict`** – запрещает удаление главной сущности, если есть зависимости.  

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<User>()
        .HasOne(u => u.Company)
        .WithMany(c => c.Users)
        .OnDelete(DeleteBehavior.Cascade); // Явное указание
}
```  

---
### Outer links:
https://metanit.com/sharp/efcore/3.2.php