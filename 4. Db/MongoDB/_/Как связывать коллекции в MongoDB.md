#db #db-mongodb
 
---
В MongoDB нет традиционных `JOIN`, как в реляционных базах, но есть несколько подходов к моделированию данных и работе со сложными запросами.

1. **Вложенные документы** — когда данные редко изменяются и их часто запрашивают вместе.
2. **Связи через `_id`** — если данные обновляются отдельно и их запрашивают по частям.
	
	```json
	// Коллекция users
	{
	  "_id": ObjectId("user123"),
	  "name": "Иван"
	}
	
	// Коллекция orders
	{
	  "_id": ObjectId("order789"),
	  "user_id": ObjectId("user123"),
	  "items": ["товар1", "товар2"]
	}
	```

---
### Как выполнять сложные запросы?

Вместо `JOIN` используются:
- **$lookup** — аналог `LEFT JOIN`, объединяет данные из разных коллекций.
- **$unwind** — разворачивает массивы в отдельные документы, если нужно работать с вложенными данными.
- **Агрегации** — мощный инструмент для выполнения сложных запросов.

Пример: получить список заказов с информацией о пользователях:
```json
db.orders.aggregate([
  {
    "$lookup": {
      "from": "users",
      "localField": "user_id",
      "foreignField": "_id",
      "as": "user"
    }
  },
  { "$unwind": "$user" }
])
```
Здесь `lookup` соединяет данные из `orders` и `users`, а `unwind` превращает вложенный массив `user` в объект.
### Outer links:

